'use strict';

// Import the Dialogflow module from the Actions on Google client library.
const {
  dialogflow,
  Permission,
  Suggestions,
  SimpleResponse,
  Button,
  Image,Carousel,
  BasicCard,
  LinkOutSuggestion,
  BrowseCarousel,BrowseCarouselItem,items,Table
} = require('actions-on-google');

// Import the firebase-functions package for deployment.

//var getJSON = require('get-json')//å¼•ç”¨å‘¼å«ç¶²è·¯å…§å®¹ä¹‹æ¨¡çµ„
//var parser=require('json-parser');

const functions = require('firebase-functions');
const replaceString = require('replace-string');
const app = dialogflow({debug: true});
var text_library = require('./text_library.json');
var text_start =["è‡˜å…«","å åœ","æ€ä¸","ç­‰æ¯”","èƒŒåŒ…","æ•—åŒ—","äº‹å€åŠŸåŠ","ç€‘å¸ƒ","è«’å¿…","ä¿æœ¬","åˆ¨å†°","åŠç™¾","å¥³ä¼´","ç§£é¦¬å²å…µ","ç­åˆ¥","é…’å§","å‡æ‰®","æ‹œæŠŠ","è¸±æ­¥","å¯¶è²","ç›Ÿé‚¦","åä½µ","è¬™å‘","é£›å¥”","ææ€–","åˆæŠ±","æ¶¼æ‹Œ","ææ‹”","è²ªæ¯","é¢æ¿","æ·¡æ³Š","å¥”æ³¢","ç›œç‰ˆ","é™„è¡¨","ç³ä¾¿","æ“”ä¿","è†œæ‹œ","æŠŠæŸ„","æ‰æŸ","å½ªç‚³","åˆ€ç–¤","èŠ’åˆºåœ¨èƒŒ","è’™èƒ","ç™¾å€","æ–‘å‰","å—·å—·å¾…å“º","é€®æ•","ç·¨ç­","ç—²ç˜‹ç—…","é‡ç ­","ç±¬ç¬†","ç³Œç²‘","é‚£èˆ¬","çµè±¹","é§•å´©","è…æ•—","å‡‹æ•","æ„šç¬¨","ç¾ˆçµ†","æ‰˜ç¼½","èˆ¹èˆ¶","ç–Šè¢«","æœ¬éƒ¨","å°é–‰","å ±å‚™","è³­åš","ç¢‰å ¡","æ’­å ±","è¼”å¼¼","å¯æ‚²","é›€æ–‘","æ£æ£’","çƒ˜ç„™","ç²‰ç­†","è¤’è²¶","é¡Œè·‹","ç›¸æ","å¢“ç¢‘","ç¶‘ç¶","å½Œè£œ","å¾©è¾Ÿ","é€²é€¼","å†°é›¹","æ¨™é¶","ä¸­é£½","åŠ£å¹£é©…é€è‰¯å¹£","åˆ©å¼Š","æ”¾æ¦œ","é‹ç®”","èƒ³è†Š","ä¾†è³“","å‘é„™","ç³•é¤…","è¾¯é§","éš†é¼»","èª¿æ’¥","å°æ’­","æŠ—æš´","ç›®æ¨™","çç·¨","ä¹Ÿç½·","çŸ‡è”½","è¥è¤“","æ³›æ³›ä¹‹è¼©","æˆˆå£","å¹«è¾¦","æ€è¾¨","ç©¿å¹«","å·¨æ“˜","å‡æ–ƒ","ç·Šç¹ƒ","è²è–„","èª¹è¬—","èº²é¿","é˜æ“º","å¼•çˆ†","é¡›ç°¸","å¸³ç°¿","åŒ—é‚Š","ç”œå…«å¯¶","é«®è¾®","è©­è¾¯","æ³¢éœ¸","ç”•ä¸­æ‰é±‰","ä¸•è®Š","å ¤å£©","é›²é¬¢","æ‡æ·","é‡˜è€™","çµç¶","å®³æ€•","é™¡å¡","é›å©†","æ€¥è¿«","é«”é­„","çˆ†ç ´","ç¯€æ‹","ä¸¦æ’","ç›¾ç‰Œ","å¥‰æ´¾","æå","æ ½åŸ¹","ç´¢è³ ","å¬ªå¦ƒ","è¨±é…","è±æ²›","æ„Ÿä½©","ç‡ˆæ³¡","é³´ç‚®","æ——è¢","å·è·‘","è§£å‰–","é«˜ä¸å¯æ”€","æ¶…æ§ƒ","å´©ç›¤","å¯©åˆ¤","æœŸç›¼","èšå¯¶ç›†","éç£…","ä¾å‚","è‡‚è†€","è‚¥èƒ–","è“†æ£š","ç‹¹è·¯ç›¸é€¢","å¹æ§","é›·åŠˆ","å‰çš®","èƒ½å¦","é›…ç—","å­¤åƒ»","ç¶ç¥¨","è–„ç‰‡","è©©ç¯‡","æ“ºä¸å¹³","èª†é¨™","æ•ˆé¡°","èˆ¶ä¾†å“","çºŒè˜","è€ƒè©•","å¥¶ç“¶","ä»»æ†‘","åº—é‹ª","è–è’²","å¥´åƒ•","å„‰æ¨¸","æ³µæµ¦","è‹—åœƒ","æ­Œè­œ","èˆ…åª½","é”æ‘©","è“–éº»","é§™é¦¬","ç ç¢¼","è¬¾ç½µ","æ‰æ‘¸","ç”šéº¼","æ¶ˆç£¨","ä¾ˆç³œ","æ¥·æ¨¡","ææ‘¹","ç“£è†œ","å¡—æŠ¹","èŠ¥æœ«","æ³¯æ²’","ä»¿å†’","ç¶»æ”¾","å‘½è„ˆ","ç­†å¢¨","ç´„è«","å¯‚å¯","ç·˜é»˜","è³¼è²·","è•éº¥","è²©è³£","è±ªé‚","æ¥Šæ¢…","æ¿ƒçœ‰","éˆåª’","åª²ç¾","èƒå¦¹","æ˜æ˜§","é€æ˜","é­‘é­…","è«‚åªš","ç†Šè²“","æ±—æ¯›","ç¹èŒ‚","æˆ´é«˜å¸½","å½¢è²Œ","å…±è¬€","ç¶¢ç¹†","è—¤è”“","æ’¥ç™¼","åˆè »","é£½æ»¿","ç€°æ¼«","æ€ æ…¢","ç…©æ‚¶","è³é–€","æ†¤æ‡£","æ…Œå¿™","é‹’èŠ’","é¹µè½","ç· ç›Ÿ","å•Ÿè’™","è¿…çŒ›","èˆ´è‰‹","è«–å­Ÿ","è¨—å¤¢","ç—´è¿·","çŒœè¬","å¥¢é¡","èƒšèŠ½ç±³","å¥§ç¥•","ç¥•å¯†","èœ‚èœœ","å¯§è¬","å°‹è¦“","å¹»æ»…","è±†è‹—","æƒæ","æµ©æ¸º","ç„å¦™","å­”å»Ÿ","ä¹–è¬¬","å†¬çœ ","çºç¶¿","ç½·å…","é»½å‹‰","å† å†•","æ»‡ç·¬","é¿ä¸è¦‹é¢","ç‰§æ°‘","ç±³é£¯","è°æ•","æ†æ†«","æ…•å","é¸é³³å’Œé³´","è¬€è²¡å®³å‘½","è¤“æ¯","ä¼æœ¨","è–°æ²","ç‘ç›®","ç•œç‰§","å¬å‹Ÿ","å¢³å¢“","ç°¾å¹•","æˆ€æ…•","é²æš®","è‚…ç©†","æ’»ä¼","åŒ±ä¹","ç«¹ç­","æ¯æ³•","åˆ‘ç½°","ç‡™é«®","æ˜¯é","å—å•¡","ç´›é£›","æ°®è‚¥","åŠ«åŒª","ç…®æ²¸","æ—…è²»","æ› å»¢","æª£å¸†","åè•ƒ","é¬§ç¿»","ä½†å‡¡","çµ®ç…©","é©å¾—å…¶å","é£è¿”","ç´¯çŠ¯","å…¸ç¯„","è¼©åˆ†","ç¹½ç´›","æ¾±ç²‰","å‚™ä»½","æ†‚æ†¤","äº¢å¥®","æ•µæ–¹","ç£¨åŠ","èŠ¬èŠ³","è¬¹é˜²","æ´æˆ¿","å¯Ÿè¨ª","æ”™æ‰¶","èª¥å°","æ¬é¢¨","å·”å³°","èœœèœ‚","è£‚ç¸«","ä¾å¥‰","è–ªä¿¸","å˜²è«·","å¦¹å¤«","è·è¶º","è‚Œè†š","ä¿¯ä¼","æ‡¸æµ®","æ¡ƒç¬¦","å˜†æœ","å¯¬å¹…","æ´ªç¦","æŸç¸›","è¿‚è…","é—”åºœ","è¹²ä¿¯","è‡Ÿè…‘","å”çˆ¶","å…Œä»˜","åº·å¾©","è¾œè² ","é¦®å©¦","ç”°è³¦","ç¾ç­”ç­”","å‹¾æ­","åˆ°é”","æ‰­æ‰“","èª‡å¤§","äº†ä¸å¾—","å©¦å¾·","è™å¾…","æ­·ä»£","å›Šè¢‹","å€Ÿè²¸","å€¦æ€ ","ä½©å¸¶","å‰ƒåˆ€","å˜®å¨","æ‰³å€’","æ¾æ¹–ç¾¤å³¶","ç£å°","æ–™åˆ°","èª¨ç›œ","éœ¸é“","å¸éƒ½","æ³°æ–—","é¡«æŠ–","è±‡è±†","æ‹šé¬¥","ç‰¡ä¸¹","æ¦œå–®","è‚è†½","æ’’æ—¦","é»¯æ·¡","ç¬¨è›‹","å¿Œæ†š","æ¦´å½ˆ","çš„ç•¶","è¤²è¥ ","é‹ƒéº","é˜»æ“‹","æ¿è•©","éœ‡ç›ª","é‚å…‰ç‡ˆ","æ¬¡ç­‰","å†·æ¿å‡³","è¹­è¹¬","è²¶ä½","å­©æ","æ·šæ»´","æ¢†ç¬›","æ´—æ»Œ","åŒ¹æ•µ","è¬åº•","åºœé‚¸","çˆ¹åœ°","æ¡¿å¼Ÿ","åŠç¬¬","çš‡å¸","å¬—é","è´è¶","åŒªè«œ","é¶¼é°ˆ","æ‘ºç–Š","é´•é³¥","ä¸Ÿä¸æ‰","ç£¯é‡£","éƒ½é¦¬èª¿","ç˜‹ç˜‹ç™²ç™²","æ…¶å…¸","æ²¸é»","é£¯åº—","è³€é›»","æ¤…å¢Š","æ·»ä¸","é‰šé‡˜","å±‹é ‚","èè¹¤ä¸å®š","æ ¡è¨‚","èƒ–å˜Ÿå˜Ÿ","è¼æ¯’","åƒµå†·","çµ±ç¨","è¤»ç€†","æœ—è®€","å«‰å¦’","å¡åº¦","ç²¥å°‘åƒ§å¤š","è¤«å¥ª","æ‡¶æƒ°","å•¦å•¦éšŠ","è‚‡ç«¯","ç¸®çŸ­","éšæ®µ","è€†è€","å£Ÿæ–·","æ‡µæ‡µæ‡‚æ‡‚","æ¶µæ´","é›•æ¢ç•«æ£Ÿ","æ€¦ç„¶å¿ƒå‹•","è¸è¸","è¹§è¹‹","å¿å¿‘","ç“¦ç‰¹","å¤šèƒèƒ","è¥¿åŒ—é¢±","å¡Œè‡º","å§æª¯","æ·˜æ±°","å¯Œæ…‹","æ«»æ¡ƒ","éé€ƒ","ä¹è¨","é¥…é ­","å‰”é€","çªºæ¢","éšªç˜","è¨ªè«‡","æ£’å£‡","æ…¨å˜†","çŒè¿·æ¹¯","æ± å¡˜","éº¥èŠ½ç³–","å»Ÿå ‚","å€œå„»","æŠ˜é¨°","æ‰¶æ¢¯","é˜²æ³¢å ¤","ä¾‹é¡Œ","èƒ´é«”","ç¢‘å¸–","æ´¥è²¼","æ–¬é‡˜æˆªéµ","éˆæ¢","çªˆçª•","è¹¦è¹¦è·³è·³","è”½å¤©","ä¸¹ç”°","é¦è…†","è«¦è½","æš«åœ","å¨‰å©·","å”çª","å®¦é€”","ç³Šå¡—","æ§‹åœ–","ç¤¬åœŸ","å˜”å","æ–¼èŸ","è¥¯æ‰˜","ä»˜è¨—","æ™è„«","æ»‚æ²±","è¹‰è·","è™ºéš¤","ä¼¸è…¿","èŸ¬è›»","æ–¥é€€","ç¤¾åœ˜","é¯¨å","æºé€š","è‹ŸåŒ","æ¢§æ¡","ä¹©ç«¥","ç± çµ±","è½ç­’","ç–¼ç—›","å‰é‚£","å—©å¶","æ¬¸ä¹ƒ","ä¿—ä¸å¯è€","éŠ˜æ„Ÿäº”å…§","æ‡Šæƒ±","æ„£é ­æ„£è…¦","å“­é¬§","å½¹ç”·","ç½¹é›£","ç¨šå«©","çª©å›Š","é€èƒ½","æ£—æ³¥","éºŸå…’","æ—–æ—","æ‚–é€†","è€½æºº","ç¥ç¨","åš…å›","æ†‹å°¿","çŠ›ç‰›","å½†æ‰­","æ¨ç´","æš®å¹´","æ‚¼å¿µ","ä¼´å¨˜","é†é‡€","æ¯‹å¯§","çŒ™ç°","åŒˆå¥´","æƒ±æ€’","å©€å¨œ","æ€¯æ‡¦","å¸­ä¸æš‡æš–","ä½ƒè¾²","å’•å™¥","å©¢å¥³","å†¶ç…‰","è¬”è€Œä¸è™","å•ªå•¦","å˜©å–‡å–‡","æ®µè½","è¾›è¾£","é…æ¨‚","å¦æ¥µæ³°ä¾†","è““è•¾","å ¡å£˜","æ¶•æ·š","é†£é¡","æŠ“ç‰¢","çŠ¬é¦¬ä¹‹å‹","ä½åƒ‚","é–£æ¨“","é„™é™‹","ç´•æ¼","æš´éœ²","æ¨æ³¢åŠ©ç€¾","è•™è˜­","ä¼½è—","ç€è¦½","æ©„æ¬–","æ…µæ‡¶","æ°¾æ¿«","ç³œçˆ›","é§­æµª","è±ºç‹¼","çºç‘¯","æª³æ¦”","çˆ½æœ—","æ’²æœ”è¿·é›¢","è—©ç±¬","è’ºè—œ","éµ¬ç¨‹è¬é‡Œ","ç­”ç†","é­è¾Ÿå…¥è£¡","ç‰²ç¦®","è¿¤é‚","åªšåŠ›","è–œè”","å©·å©·ç‰ç«‹","é¡†ç²’","ç‰Ÿåˆ©","ç˜Œç—¢","æ…£ä¾‹","æ‚šæ…„","æ·…ç€","æƒ•å‹µ","ç ¥ç¤ª","ç¶ºéº—","ä¼‰å„·","ä¼å€†","å‡œå†½","çŒ›çƒˆ","å¤©å´©åœ°è£‚","æ‹™åŠ£","æ¶‰çµ","å¹•åƒš","é·¦é·¯","å…ä¸äº†","è©æ–™","æ¹æµ","æŒ½ç•™","è´…ç˜¤","æ¯—é€£","å«å¥©","é‚¦è¯","æ‰®é¬¼è‡‰","é›éŠ","æ›¼é™€æ—","ç¦é„°","éº’éºŸ","ç€•è‡¨","æ…³å","è¹‚èºª","é™¤æš´å®‰è‰¯","æ¼‚äº®","æ²æ¶¼","æ£Ÿæ¢","è†ç²±","ä¼°é‡","å¯…åƒå¯ç³§","æ–¤å…©","èŒ¯è‹“","ç•¸é›¶","é¶ºé´’","ä¸˜é™µ","å‹’ä»¤","å˜°å“©å’•åš•","çƒ¤çˆ","è‘«è˜†","ä¿˜è™œ","é³³æ¯›éºŸè§’","ç¿ ç¶ ","è¼¯éŒ„","éº‹é¹¿","è½‚è½†","æ””è·¯","å˜å›‰","é™€èº","çŠé™€ç¾…","åƒ‚å„¸","ç“”ç","å³°å·’","æˆ¡äº‚","å´‘å´™","è¬¬è«–","æ¸¡è¼ª","å°¼é¾","å–‰åš¨","ç²ç“","æœ¦æœ§","æ¨Šç± ","è¥¤è¤¸","è“½è·¯è—ç¸·","åœ¯æ©‹é€²å±¥","æ—‹å¾‹","å€ç‡","å ªæ…®","æ“„æ ","ç—™æ”£","é©ªæ­Œ","å®°å‰²","èŠå‚™ä¸€æ ¼","åˆªæ”¹","æ¢—æ¦‚","æ²é‹ªè“‹","ä¿¸çµ¦","è„£è†","æ’°ç¨¿","è¨ƒå‘Š","æ¿ æº","é¬£ç‹—","æ¶æ§‹","è‹¥å¹²","æ¡…æ†","å¸è²¨","é‡£ç«¿","æ¤ªæŸ‘","é¤…ä¹¾","æ§“æ¡¿","ç«Ÿæ•¢","æ•æ„Ÿ","æ…§æ ¹","å„’è‰®","æªç¼¸","ç€§å²¡","å¡‘é‹¼","é–‰é–€ç¾¹","æ¡”æ¢—","å˜€å’•","ç¿å§‘","è‚‹éª¨","çŸ½è°·","å±è‚¡","é‘¼é¼“","æ¡æ¢","éå›º","è—‰æ•…","æƒ é¡§","å“ˆå¯†ç“œ","åœå¦","é —ç‚ºå¯è§€","è³¦æ­¸","æ¼©æ¸¦","æ¹é»‘é‹","æ¾¤åœ‹","å·¾å¹—","é†œå…«æ€ª","è˜‹æœ","æŠµä¸é","é™‹è¦","é¤“é¬¼","æ˜‚è²´","æ«¥æ«ƒ","éš›æœƒ","é»œå®˜","æ¡‚å† ","æ½¼é—œ","è¼¸åµç®¡","ç±è²«","æ˜“é–‹ç½","å»æ··","éŸœå…‰","é›‡å·¥","ç·‹ç´…","é èº¬","ç§‰å…¬","é»Œå®®","æ¢­å“ˆ","ä»‹é¢å¡","èŒ„ç§‘","è²æ®¼","è¿ªæ–¯å¯","æœ›æ¢…æ­¢æ¸´","æ‘©å´–çŸ³åˆ»","é¢å®¢","æ’¬é–‹","æ…·æ…¨","è†¾ç‚™äººå£","ç´æ‰£","å€­å¯‡","è³è”»","åˆ®ç›®ç›¸çœ‹","èª æ‡‡","å•¼å“­","æ‚½è‹¦","å€‰åº«","é¼é—Š","æ„‰å¿«","ä¿„ç¾…æ–¯æ–¹å¡Š","è…è™§","æ…šæ„§","è²¸æ¬¾","ç±®ç­","ç™²ç‹‚","æç©º","éˆ¾ç¤¦","ç³å­”","æƒ¶æ","å†å–","åª¾å’Œ","æ‹Œåˆ","å¥ˆä½•","æ±¾æ²³","ç¨½æ ¸","æ«åš‡","æ­è³€","å¬°å­©","ç’§é‚„","æ¸¤æµ·","æ±ªæ´‹","å¦¨å®³","æ¼†é»‘","èŒ¼è’¿","æ‹¬è™Ÿ","ç™–å¥½","å’½å–‰","ç¼çŒ´","å˜¶å¼","æ†¨åš","ç»å‰é¡§å¾Œ","ç—‡å€™","é¡¢é ‡","è˜Šå«","é…·å¯’","å¶å–Š","æ©æ±—","é©ƒæ‚","é–€å¤–æ¼¢","ç–¤ç—•","æ†¾æ¨","æ­¥è¡Œ","é€¾æ†","é©•æ©«","å—šå‘¼","ææƒš","é„±é™½æ¹–","çŠç‘š","æ¼¿ç³Š","è¶³ä¸å‡ºæˆ¶","è·‹æ‰ˆ","åº‡è­·","å­µåŒ–","ç«ç‘°èŠ±","é»›ç¶ å¹´è¯","æ“˜åŠƒ","ç´æ£‹æ›¸ç•«","å–Šè©±","çƒ½ç«","å‚¢ä¼™","æ§æœ¨æ­»ç°","æŠ‘æˆ–","è³ˆç¦","è™œç²","å¾˜å¾Š","ç·¬æ‡·","çš®å½±æˆ²","é§å›","æ‡ºæ‚”","è©†æ¯€","è˜†è–ˆ","è½æ°´æ‰¿æ­¡","èˆ¬æ¡“","æ±°æ›","ç‚³ç…¥","é¥‘è’","å¾¬å¾¨","ç‡‰ç…Œ","ç¡«é»ƒ","ç‚®è½Ÿ","éœ“è™¹","ç°¸ç®•","éŒ„æ”¾å½±æ©Ÿ","å›¤ç©","ç—•è·¡","é›‰é›","å™¬è‡è«åŠ","æ™‰ç´š","ç¬å³","çŒ´æ€¥","ç˜§ç–¾","å¦’å«‰","è·¼è¹","æ¯ç›¤ç‹¼è—‰","èˆŸæ¥«","é‚è¼¯","èŠæ£˜","æŠ¨æ“Š","å¦²å·±","å«–å¦“","æœ­è¨˜","æ—ºå­£","ç·©å…µä¹‹è¨ˆ","æ´²éš›","ç£ºèƒºåŠ‘","è¸è–º","è¸µç¹¼","æ„ˆåŠ ","ç‘œä¼½","èŠå®¶","é¾œç”²","æš‘å‡","æ£šæ¶","å“„æŠ¬ç‰©åƒ¹","éŠ²æ¥","ç™¥çµ","ç½µè¡—","è¿«åœ¨çœ‰ç«","é€¢å¹´éç¯€","ç­‹ç–²åŠ›ç«­","çšæ½”","ç­è§£","ä»²ä»‹","ç™¬ç–¥","æ¥šæ²³æ¼¢ç•Œ","é½‹æˆ’","å…«æ‹œä¹‹äº¤","å¸Œè‡˜æ­£æ•™","è¾£æ¤’","èˆŒæ•è„£ç„¦","å’€åš¼","è·›è…³","è’è’å«","éŒ™éŠ–å¿…è¼ƒ","é¶»é³©","æ†ä¹…","å•¤é…’","çª è‡¼","ä»èˆŠ","æ­‰ç–š","æ‹¯æ•‘","è†šæ·º","åŠé–“","ç¯©æª¢","å‡½ä»¶","ç¥è¦‹","çŸ¯å¥","éˆé‘’","å¼“ç®­","è«·è««","ç¶¸å·¾","è¿„ä»Š","ç’ç‰æ¸¾é‡‘","å–œä¸è‡ªç¦","ä»€éŒ¦","åŠ æŠŠå‹","èºé€²","æ®†ç›¡","æ±¨ç¾…æ±Ÿ","æ‚å°‡","è«¾è²çˆ¾ç","è‡­çš®åŒ ","éœœé™","å€”å¼·","ç‚¸é†¬","ç€é’","è•ªè","é±—è–","é€”ç¶“","è™•è®Šä¸é©š","ç“¶é ¸","æ‹å¤–æ™¯","æ†§æ†¬","å¦é—¢è¹Šå¾‘","ç¶é–","çª—æ˜å‡ æ·¨","æ¼«ç„¡æ­¢å¢ƒ","å‡¸é€é¡","ç•¢æ­ç•¢æ•¬","æ³ä¸”","è¶‘è¶„","ç¯·è»Š","å¾™å±…","æŸ‘æ©˜","è¸°çŸ©","æšèˆ‰","å©‰æ‹’","èƒ¼æ‰‹èƒè¶³","ç‚Šå…·","èŸ è¸","ç²µåŠ‡","è¨€å¿…æœ‰æ“š","å‹›çˆµ","å—…è¦º","èº‹èº«","äº¤ç™½å·","çå€¦","éƒå›","å›è»","é»´èŒ","å¨¶å¦»","è”æ","å°¤å…¶","è±¡æ£‹","è±ç™½æ——","å¶”å´","æ¸æ","è¿­èµ·","æ‚¶æ°£","å•œæ³£","æ“¯æ£„","å™´éœ§å™¨","å‰´åˆ‡","å‰½ç«Š","éµ²æ©‹","å¤¢å¯ä»¥æ±‚","ä¹’ä¹“çƒ","é‘²åµŒ","å­Ÿæ¯ä¸‰é·","æ”¢éŒ¢","çœè¦ª","æ…‡æ‡ƒ","é—é˜","å¡è³“æ§","è¸‰è¸‰è¹Œè¹Œ","é¬©ç‰†","æ¾„æ¸…","å’¨è«‹","æ¯«ä¸ç•™æƒ…","èªŒæ…¶","å¥é³´æ›²","éƒŠå€","å´å¶‡","äº¦æ­¥äº¦è¶¨","æ“·å–","æ—¨è¶£","æˆ–ç¼º","è±æ‹³","å›æ¬Š","ç’çŠ¬","è¥–è£™","è…•é“ç—‡å€™ç¾¤","é»”é©¢æŠ€çª®","å„å¥”æ±è¥¿","å®å¸","å‰–æ","æ¿‚æºª","åæƒœ","ç­µå¸­","æ£²æ¯","å©†åª³","æ»ç†„","ç›¥æ´—","æ•å±£","çš†å¤§æ­¡å–œ","æœä¸ä¿å¤•","è­œç³»","è£™å¸¶é—œä¿‚","å¥¸ç´°","å“å‘€","è¤Šç‹¹","çä¸Šæ¬ºä¸‹","é–‘æš‡","è¾Ÿé‚ª","è©¼è«§","æ¤å¿ƒæ³£è¡€","æ‘¹å¯«","èƒèŸ¹","çŒ¥è¤»","é´Ÿé´","å½¼é•·æˆ‘æ¶ˆ","å¯¦å ±å¯¦éŠ·","å’†å“®","çœ‡å°","æ‹‚æ›‰","ç¶­å¦™ç¶­è‚–","å€£æ•ˆ","è¨•ç¬‘","å–„ç½·å¹²ä¼‘","å™¢å’»","æ‘§æ¯æ‹‰æœ½","é‹Œè€Œèµ°éšª","æ”è­·è…º","æ‹‹ç‰©ç·š","è†ç”°ç¸£","æ˜§å¿ƒ","ç°‡æ–°","é‡œåº•æŠ½è–ª","å¯µä¿¡","å„ç›¸","ä¸é¦™","æ‹å¯®é„‰","ç¦¨ç¥¥","ç¿±ç¿”","éæƒ³","å’¯å’¯ä½œéŸ¿","è„ˆè±¡","è‚–åƒ","å‰‹æ˜Ÿ","è‘·è…¥","æ©¢åœ“å½¢","å–šé†’","æƒ°æ€§","åƒ¥å€–","å”å™“","äº›é ˆ","é¬é¬š","ç§©åº","éŠ“æ•˜","å¨å¨çµ®çµ®","é¡“é Š","çŠåº­æƒç©´","æ•¦å“å‹µå­¸","ç‘é›ª","æ¤¿è±","æ–¡æ—‹","è†ºé¸","æ¢Ÿé›„","è«®è©¢","æ¡€é©ä¸é¦´","åº­è¨Š","è¶¨å‰é¿å‡¶","è²“ç†Š","æ¨‚ä¸å¯æ”¯","æ®Šä¸çŸ¥","èƒ­è„‚","ç´¡ç¹”","å¹£å€¼","éˆ£è³ª","ç€†è·","æˆ›ç„¶è€Œæ­¢","æ‹‡æŒ‡","åæ²»","åŒ…ç­åˆ¶","é†ƒè£½","ç¿æ™º","çƒæ»¯","å°‰é²","æ™®æŸ¥","å±å±å–³å–³","èèš±","è¨›è©","å±å’","å¤­æŠ˜","è¿¦è‘‰å°Šè€…","è—·è”—","æŠ‰æ“‡","ç¡ä¸è‘—","å¥æ˜Ÿé«˜ç…§","æœ•å…†","ä¸€æŠŠç½©","æ¹„å·","ç›ªèˆŸ","æ£è‚˜","å®‡å®™","è©›å’’","è¿é‚…","æ„çœ‰ä¸å±•","å±¢æ•—å±¢æˆ°","èé¡ä¸æŒ¯","è¿”ç’æ­¸çœŸ","æŒ‡åŒ—é‡","ç–±ç–¹","å®‹æ±Ÿé™£","ç¯‡ç« ","åŠæ‹”å¼©å¼µ","èœšçŸ­æµé•·","é£†æ¼²","å»·æ–","è†¨è„¹","å±éšœ","é‚ªä¸å‹æ­£","å¾¡é§•è¦ªå¾","é·¸èšŒç›¸çˆ­","å¸•é‡‘æ£®æ°ç—‡","å‡†è€ƒè­‰","èšŒç ","èœ˜è››","å‚µè‡ºé«˜ç¯‰","éƒ¡ä¸»","çƒ¹ç…®","æ“‹ä¸ä½","æŒ¹æ³¨","æ–Ÿé…Œ","é§Ÿé¦¬é›£è¿½","ç Œç£š","è¼¾è½‰","å»¬å±±","è¬ å‚³","ç„æº–","ç”·æ‰®å¥³è£","ç†ä¸ç›´æ°£ä¸å£¯","è½è½æ’æ’","å†¥å†¥ä¹‹ä¸­","è‡ƒè…«","é„­é‡","å¯¡ä¸æ•µçœ¾","å™—å“§","å’«å°º","æ¾ æ± ","çŸœæŒ","é‘°åŒ™","æ¬ä¸çŸ¥æ¥","æ‹Šè†ºåˆ‡é½’","æ’æˆ","è²¿æ˜“é †å·®","èŒ—èŒ¶","åŠˆæŸ´","é³©å éµ²å·¢","ä½³è©•å¦‚æ½®","æ‹”å¾—é ­ç±Œ","å™¤è‹¥å¯’èŸ¬","è««è‡£","èª•è¾°","ç‰é›å¸æ™¨","ä¹å–„å¯é™³","è³ å„Ÿ","æ§å ´","è©è–©å¿ƒè…¸","æƒ†æ‚µ","æš±ç¨±","åŠŸæ•—å‚æˆ","èŒ‚ç››","å’Œç›¤æ‰˜å‡º","æ‚”ä¸ç•¶åˆ","éŸé™¤","èºŠèº‡","è¸Ÿèº•","æ°åˆ°å¥½è™•","ç¯£æ¥š","ç‰´è§¸","é½·é½ª","å¼¦æ­Œä¸è¼Ÿ","ç§¤éŒ˜","å“®å–˜","æ¯æœ¨é€¢æ˜¥","éµªé¶‰","ç—˜ç˜¡","éŠ‘åºŠ","ç“¢èŸ²","æ®­å±","æ©Ÿä¸å¯å¤±","æªæ–½","ç±¤è©©","ç£çŸ³","è¦“é£Ÿ","æ˜”æ™‚","æ¨¸å¯¦","å€˜ä½¿","çˆµå£«","é–¼æ°","è”‘è¦–","æ½˜å®‰å†ä¸–","è¶å¼","èˆ”æ‹­","å˜—è©¦","è‘£ç›£äº‹","ä¹ƒæ˜¯","ä»—å‹¢","æ“‡è‚¥è€Œå™¬","ç´ ä¸ç›¸è­˜","æ¸™ç„¶å†°é‡‹","æŠ¹ç…","åš¼èˆŒ","èŸ’è›‡","é€€é¿ä¸‰èˆ","é¥è€Œä¸æ¨","è¼»å°„","ç½ªä¸å¯èµ¦","è¤è‰²","æ›æ™’","èˆæˆ‘å…¶èª°","ç›¯æ¢¢","å‰ç‡’","æ–—æ“","åƒ§å¤šç²¥å°‘","å´—å“¨","å«»ç†Ÿ","æ‰’æ‰‹","æªå®ˆ","åŒ•é¦–","åµ©å£½","æŒ‘è‚¥æ€ç˜¦","ç¦½ç¸","æ¤è¡«","è’²æ‰‡","é„¯å–„","æ¢ç´³","åšå¤§ç²¾æ·±","ç‚¯ç‚¯æœ‰ç¥","åˆ¸å•†","è£¹å‚·","ç¬›è²","å¯ä¸Š","çŠ’è³","çˆ¬å‡","ç—›ä¸æ¬²ç”Ÿ","çŠ§ç‰²","æ‚²ä¸è‡ªå‹","éŸç¹©","å¸›æ›¸","æº½æš‘","è¢‹é¼ ","å…¬å€æ•¸","ç¬¬å…«è—è¡“","èšèœ‰æ’¼æ¨¹","æ·æ°´","çŒç¡","ç ’éœœ","é›‹çˆ½","æŸæ—¥","çŒ©ç´…ç†±","åº¸äººè‡ªæ“¾","ç¹šç¹","æ¶®ç¾Šè‚‰","é©€ç„¶","èè‹’","æ¸²æŸ“","åª’äºº","èä»»","è–ä»","çŸ¢å£å¦èª","é—•å¦‚","ä¾å„’","å›åš…","é†±é…µä¹³","é‚å…¥","ç·è¾±","è«è‹¥","ç¾¸å¼±","è’Ÿè’»","è‘³è•¤","é›å®¹","èŠ™è“‰","é›–æ•—çŒ¶æ¦®","å´¢å¶¸","å›¡ä»”","é »æ¬¡","æ‰€è²»ä¸è²²","å¸½å­","æ¸£æ»“","æ‹¼éŸ³æ–‡å­—","é¾é›œ","è­´è²¬","èŸŠè³Š","è¢æ¾¤","ç›†æ ½","æ”†èµ°","é–“å¥","é Œè®š","éª¯é«’","æ®¯è‘¬","çµè¦–æ˜‚è—","è„¾è‡Ÿ","é¤½è´ˆ","ç„å’","ä¾—æ—","åš‡é˜»","åª½ç¥–","è¶ºå","æœ«åº§","å’§å˜´","åˆ¤ç½ª","ç›²å¾","å”¸å”¸æœ‰è©","è—ä¸å¯æ¸¬","æ‚±æƒ»","é¨™è²¡","å¼µç‡ˆçµç¶µ","è²·èœ","æ‹ˆèŠ±æƒ¹è‰","ä¸ƒæ‹¼å…«æ¹Š","å°¸ä½ç´ é¤","ç’€ç’¨","ä¾·ä¿ƒ","é¡°è¹™","å¿™ä¸­æœ‰éŒ¯","ç¿¡ç¿ ","å½·å¾¨å¤±æª","é¼é‚ŠéŠ¼","æ†”æ‚´","è–ˆèƒ","è»‹é ­å¯¸","å¾‡ç§","è½æ–¯","èŸçµ²","è²Œä¼¼","ä¸‡ä¿Ÿ","æ½‘ç‘","æŠ«è–©","èŒ…å¡","é˜®å›Šç¾æ¾€","å¾‘è³½","ç™Ÿä¸‰","å¦»é›¢å­æ•£","æ­å·´æ¡‘","è²§åƒ§","æ»´ç²‰æ“é…¥","æ°¯é»´ç´ ","é¤é¢¨éœ²å®¿","ç½Œç²Ÿ","çª¸çª£","å›‰å”†","æ·é–","ç¡¼é…¸","ææŒ‡ä¸€ç®—","è“¬é¬†","åµ¯å³¨","å§®å¨¥","åŒ¾é¡","æ€’ä¸å¯é","é»˜å“€","ç½£ç¤™","ç…ç†¬","å€¨å‚²","å¸ƒå¶","æƒ´æƒ´ä¸å®‰","é¦¬é","æ»…é–€è¡€æ¡ˆ","è•çˆ¾","æ¯›è¡£","æ†‘ä¾","è »å¤·","ä¾¿å®œ","æœµé ¤","ç©´è¨ºå„€","é€¼ä¸å¾—å·²","é‚„å¯ä»¥","é€¶è¿¤","å…«ä¸€ä¸‰ä¹‹å½¹","è£¨ç›Š","åå…«èˆ¬æ­¦è—","æ±‚åŒå­˜ç•°","äººæœ¬ä¸»ç¾©","è©•è­°","æ„œæ„","è–‘æ¯é´¨","ä½¶å±ˆè±ç‰™","å …å£æ¸…é‡","è‚˜è…‹","æ‰‰é ","å…¢å…¢æ¥­æ¥­","è™èƒŒç†Šè…°","æ¶æ„","å±¹ç«‹ä¸æ–","é€é™","é—¢è¬ ","æ•·è—¥","ç‚«è€€","ä¿³å„ª","ç…¤æ²¹","é¨éŠ","æœ‹å‹","å¨é€¼åˆ©èª˜","å“½å’½","å¦™ä¸å¯è¨€","é¼»ç«‡ç‚","é å²©","è”“å»¶","èœ¿èœ’","èµ§é¡","æŸ´ç±³æ²¹é¹½","ç‡çœ¼","ç€²ç©","å™ªéŸ³","å‘»åŸ","è³£æ·«","èš¯èš“","ç°é£Ÿç“¢é£²","æºå°","ç¾šç¾Š","å¾œå¾‰","é£„æš","è±¢é¤Š","æ¨¡æ¨£","ç´®ç‡Ÿ","æ³¡å½±","å®¶ç ´äººäº¡","å’¿å””","å—ç„¡","æ™Œåˆ","çª®å…µé»·æ­¦","ç‹æ­¥èˆ","æ£˜çš®å‹•ç‰©","äº•åº•ä¹‹è›™","æœ‰æŠŠæ¡","æ’å¤–","æ°›åœ","ç½é•","å´´åµ¬","è–”è–‡","é—Œå°¾","å¥åŠŸç”šå‰","è®–ç·¯","å“å‘³","æ¯ä½","æè¡›","çªä¸¸","å‚æ™š","å„„è¬","é§¢æ–‡","æ«å¿ƒè‡ªå•","é­”ç‹","ç†™ä¾†æ”˜å¾€","ç›¼æœ›","ç—°ç›‚","è³¸é¤˜","èŒ±è¸","ç‘¾ç‘œ","é°»é­š","çœ‰å®‡","æ¢…é›¨","ç‰‡èª","æ°‘èƒç‰©èˆ‡","åŸ¹è‚²","æ²æµ´","é¦¥éƒ","è­¬å–»","ç—Šç™’","ç•›åŸŸ","æ²½åé‡£è­½","è“Šé¬±","ä¸°å§¿ç¶½ç´„","æ»¿æœˆ","æ”€è¶Š","æ‰¹é–±","è¸´èº","åŸ‹æ€¨","ç¾å…ƒ","æ–·å£æ®˜å£","ç‹„æ–¯è€æ¨‚åœ’","ç‡åŸ","ç¥¨æº","è ‘èˆ","æ´¾å“¡","æ“æ¹¯åœ“","åé ","é‚å…¶æ‰€é¡˜","å·é›²","éœ‰é‹","å¹³åº¸","é©å‹‡","æ…¢ç”¨"];
var Total_Count=0;
var sys_word="";
var input_word="";
var last_word="";
var first_word="";
var number="";
var output_array="";
var menu=false;            //åˆ¤åˆ¥æ˜¯å¦åœ¨æ­¡è¿é é¢
var end_game=false;        //åˆ¤åˆ¥éŠæˆ²æ˜¯å¦å·²çµæŸ
var question_output=false; //åˆ¤åˆ¥æ˜¯å¦æ‹¿åˆ°å‡ºé¡Œç›®è¨±å¯
var answer_input=false;    //åˆ¤åˆ¥æ˜¯å¦è¼¸å…¥è¨±å¯çš„ç­”æ¡ˆ
var reported=false;        //åˆ¤åˆ¥æ˜¯å¦å·²ç¶“èªªæ˜å›å ±å•é¡Œæ©Ÿåˆ¶
var input_list=new Array([]);;
var checker=false;var repeat=false;
var input_init="";var start_game=false;
var error=false;
var sys_suggest="";
var inputarray=["ğŸ”„ é‡æ–°é–‹å§‹","å†ä¾†ä¸€æ¬¡","å†ç©ä¸€æ¬¡","å†è©¦ä¸€æ¬¡","å†ä¾†","é‡æ–°é–‹å§‹","é‡ä¾†","å¥½","OK","å¯ä»¥","å†ä¸€æ¬¡","å¥½å•Š"];
var return_array=["æº–å‚™æ¥æ‹›å§!","å°èœä¸€ç¢Ÿ ğŸ˜","èƒ½æ¥çš„è©é¡¯è€Œæ˜“è¦‹å‘¢!","é€™é‚„ä¸ç°¡å–®?","è¼•è€Œæ˜“èˆ‰çš„å•é¡Œ"];
var wrong_array="";
var jumpcount="";
var subtitle_suggest="";
var wrong_count=0;

function isChn(str){
            var reg=/^[\u4E00-\u9FA5]+$/;
            if(!reg.test(str)){
            return false; //ä¸å…¨æ˜¯ä¸­æ–‡
            }
            return true;  //å…¨æ˜¯ä¸­æ–‡
            }

app.intent('é è¨­æ­¡è¿èªå¥', (conv) => {
	
if(conv.user.verification === 'VERIFIED'){
  if(conv.screen){
	 menu=true;question_output=false;end_game=false;Total_Count=0;input_list=[];start_game=false;
	 input_word=""; last_word=""; first_word="";reported=false; 

	conv.ask(new SimpleResponse({               
		speech: `<speak><p><s>æƒ³å’Œæˆ‘ä¸€è¼ƒé«˜ä¸‹å—?</s><s>åœ¨éŠæˆ²éç¨‹ä¸­ï¼Œè©å½™ä¸èƒ½é‡è¤‡!</s><s>èˆ‡æ­¤åŒæ™‚ï¼Œä½ éš¨æ™‚éƒ½èƒ½é€€å‡ºæŒ‘æˆ°çµç®—æˆç¸¾!</s><s>ä¾†æŒ‘æˆ°çœ‹çœ‹å…«!</s></p></speak>`,
		text: 'æ­¡è¿ä¾†æŒ‘æˆ°!',}));

	conv.ask(new BasicCard({   
			image: new Image({url:'https://imgur.com/yTy9fks.jpg',alt:'Pictures',}),
			title: 'éŠæˆ²è¦å‰‡',
			subtitle:'  â€¢ å‰å¾Œè©å½™çš„å­—å°¾èˆ‡å­—é¦–å¿…é ˆç›¸åŒ\n  â€¢ åœ¨éŠæˆ²éç¨‹ä¸­ï¼Œè©å½™ä¸èƒ½é‡è¤‡!\n  â€¢ éš¨æ™‚éƒ½èƒ½è·³éè©å½™ï¼Œå…±æœ‰ä¸‰æ¬¡æ©Ÿæœƒã€‚\n  â€¢ ä½ éš¨æ™‚éƒ½èƒ½é€€å‡ºçµç®—æˆç¸¾ã€‚',
			text:'â’¸ å‰µç”¨CC å°ç£3.0ç‰ˆæˆæ¬Š',
			buttons: new Button({title:'ã€Šæ•™è‚²éƒ¨é‡ç·¨åœ‹èªè¾­å…¸ä¿®è¨‚æœ¬ã€‹',
								 url: 'http://dict.revised.moe.edu.tw/cbdic/',}), 
	}));
   conv.ask(new Suggestions('ğŸ® é–‹å§‹æŒ‘æˆ°','ğŸ‘‹ æ°æ°'));
  }else{

	   menu=false;question_output=true;end_game=false;Total_Count=0;input_list=[];start_game=true;
	   input_word=""; last_word=""; first_word="";
        
		 if (conv.user.last.seen) {
	  	conv.ask(`<speak><p><s>æ­¡è¿å›ä¾†!</s><break time="0.3s"/><s>åœ¨ä½ é–‹å§‹æ¥é¾å‰ï¼Œå¯ä»¥èªª<break time="0.2s"/>é‡æ–°é–‹å§‹<break time="0.2s"/>è®“æˆ‘é‡æ–°æƒ³ä¸€å€‹è©å½™ä½œç‚ºé–‹é ­ã€‚</s><s>ç•¶ä½ æ¥ä¸ä¸‹å»æ™‚ï¼Œå¯ä»¥å°æˆ‘èªª<break time="0.2s"/>è·³ã„ã„¨ã„›Ë‹<break time="0.2s"/>è®“æˆ‘å¹«ä½ æƒ³ä¸€å€‹è©å½™</s><break time="0.3s"/><s>æº–å‚™å¥½äº†å—?<break time="1s"/></s></p></speak>`);}
		else{
	  	conv.ask(`<speak><p><s>åœ¨é–‹å§‹éŠæˆ²å‰ï¼Œæˆ‘éœ€è¦è·Ÿæ‚¨é€²è¡Œèªªæ˜ã€‚æœ¬æœå‹™çš„èªéŸ³è¾¨è­˜ç”±GoogleåŸ·è¡Œã€‚</s><s>ç¢°åˆ°åŒéŸ³è©æˆ–é›œéŸ³ç­‰å•é¡Œæ™‚ï¼Œå¯èƒ½æœƒç™¼ç”Ÿè¾¨è­˜éŒ¯èª¤ã€‚åƒ…æ­¤çŸ¥æœƒä½ ä¸€è²!</s><break time="0.5s"/><s>æ­¤å¤–ï¼Œåœ¨ä½ é–‹å§‹æ¥é¾å‰ï¼Œä½ å¯ä»¥èªª<break time="0.2s"/>é‡æ–°é–‹å§‹<break time="0.2s"/>è®“æˆ‘é‡æ–°æƒ³ä¸€å€‹è©å½™ä½œç‚ºé–‹é ­ã€‚</s><s>ç•¶ä½ æ¥ä¸ä¸‹å»æ™‚ï¼Œå¯ä»¥å°æˆ‘èªª<break time="0.2s"/>è·³é<break time="0.2s"/>è®“æˆ‘å¹«ä½ æƒ³ä¸€å€‹è©å½™</s><break time="0.3s"/><s>æº–å‚™å¥½äº†å—?<break time="1s"/></s>`);}

		number=parseInt(Math.random()*1511)
		sys_word=text_start[number];   
        last_word=sys_word.split('');
		last_word=last_word.pop();
		
        input_list.push(sys_word);//å°‡è©å½™å­˜å…¥ä½‡åˆ—
		
	   	conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>ç¬¬ä¸€å€‹è©å½™æ˜¯<break time="0.2s"/>${sys_word}</s></p></speak>`,
			text: 'é–‹å§‹å•¦ğŸ\nè‹¥è¼¸å…¥é‡è¤‡çš„è©å½™ç›´æ¥çµæŸã€‚',}));
	    conv.noInputs = ["æˆ‘å‰›å‰›èªªçš„æ˜¯"+sys_word+"ï¼Œè«‹èªªä»¥"+last_word+"ç‚ºé–‹é ­çš„è©å½™","éŠæˆ²å·²ç¶“é–‹å§‹å›‰ï¼Œè«‹èªªä»¥"+last_word+"ç‚ºé–‹é ­çš„è©å½™","æŠ±æ­‰ï¼Œç”±æ–¼æ‚¨æ²’æœ‰å›æ‡‰å› æ­¤éŠæˆ²åˆ°æ­¤çµæŸã€‚ä¸‹æ¬¡è¦‹ã€‚"];	   
	
		}
	}else{
		conv.ask(new SimpleResponse({               
                      speech: "åœ¨é–‹å§‹å‰ï¼Œæ‚¨éœ€è¦å•Ÿç”¨GoogleåŠ©ç†ï¼Œæˆ‘æ‰èƒ½æä¾›ä½ å€‹äººåŒ–é«”é©—å–”!",
                       text: 'è«‹é€²è¡Œç›¸é—œè¨­å®šï¼Œæ‰èƒ½é€²è¡ŒéŠæˆ²!',}));
	   conv.close(new BasicCard({   
			image: new Image({url:'https://www.gstatic.com/images/branding/product/2x/assistant_48dp.png',alt:'Pictures',}),
			title: 'éŒ¯èª¤ï¼šæ‚¨éœ€è¦é€²è¡Œè¨­å®š',
			subtitle:'Google åŠ©ç†éœ€è¦æˆæ¬Š(è«‹é»æ“Šç•«é¢å³ä¸‹æ–¹çš„ã€Œé–‹å§‹ä½¿ç”¨ã€)ã€‚\næˆæ¬Šå¾Œæˆ‘æ‰èƒ½ç‚ºä½ å„²å­˜å€‹äººå°è©±ç‹€æ…‹ï¼Œ\nè—‰æ­¤æå‡ä½ çš„ä½¿ç”¨é«”é©—!\n', 
			display: 'CROPPED',
		}));}
		
 conv.user.storage.menu=menu;
 conv.user.storage.end_game=end_game;
 conv.user.storage.question_output=question_output;
 conv.user.storage.sys_word=sys_word;
 conv.user.storage.last_word=last_word;
 conv.user.storage.input_list=input_list;
 conv.user.storage.Total_Count=Total_Count;
 conv.user.storage.start_game=start_game;
 conv.user.storage.reported=reported;
 conv.user.storage.jumpcount=0;
 conv.user.storage.wrong_count=0;

});

app.intent('å•é¡Œç”¢ç”Ÿå™¨', (conv,{input}) => {

 menu=conv.user.storage.menu;
 end_game=conv.user.storage.end_game;
 question_output=conv.user.storage.question_output;
 last_word=conv.user.storage.last_word;
 sys_word=conv.user.storage.sys_word;
 input_list=conv.user.storage.input_list;
 Total_Count=conv.user.storage.Total_Count;
 start_game=conv.user.storage.start_game;
 reported=conv.user.storage.reported;
 jumpcount=conv.user.storage.jumpcount;
 wrong_count=conv.user.storage.wrong_count;


 if(input==='é–‹å§‹æŒ‘æˆ°'){
 menu=true;question_output=false;end_game=false;Total_Count=0;input_list=[];start_game=false;
 input_word=""; last_word=""; first_word="";reported=false; jumpcount=0;wrong_count=0;
}

//ã€Œé–‹å§‹éŠæˆ²ã€å•Ÿå‹•è©åˆ¤æ–·
  if(menu===true&&end_game===false&&question_output===false&&reported===false){
      if(input!=='é–‹å§‹æŒ‘æˆ°'){input='é–‹å§‹æŒ‘æˆ°';}
      if(input==='é–‹å§‹æŒ‘æˆ°'){ menu=false;question_output=true;end_game=false;}
  }

  //çµç®—ç•«é¢é˜²å‘†åˆ¤æ–·
  if(menu===false&&end_game===true&&question_output===false&&reported===false){
     if(inputarray.indexOf(input)!==-1){
	  menu=false;question_output=true;end_game=false;Total_Count=0;input_list=[];start_game=false;reported=false;}
      jumpcount=0;}
	  
if(conv.user.verification === 'VERIFIED'){
  if(menu===false&&end_game===false&&question_output===true&&reported===false){
	  
  if((input==='é‡æ–°é–‹å§‹'||input==='ğŸ”„ é‡æ–°é–‹å§‹')&&Total_Count===0){input_list=[];start_game=false;reported=false;jumpcount=0;wrong_count=0;}

	if(start_game===false){
		start_game=true;

		//é¸å‡ºæœ€ä¸€é–‹å§‹çš„è©ï¼ŒåŒæ™‚åŸ·è¡Œé©—è­‰çœ‹æ˜¯å¦èƒ½æ¥ä¸‹å»
       //è‹¥æ˜¯ä¸è¡Œå‰‡é‡æ–°æŒ‘é¸ä¸€å€‹å­—	   
		number=parseInt(Math.random()*1511)
		sys_word=text_start[number];   
        last_word=sys_word.split('');
		last_word=last_word.pop();
		
        input_list.push(sys_word);//å°‡è©å½™å­˜å…¥ä½‡åˆ—
		
	   	conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>é–‹å§‹å•¦!</s><s>ç¬¬ä¸€å€‹è©å½™æ˜¯<break time="0.2s"/>${sys_word}</s></p></speak>`,
			text: 'é–‹å§‹å•¦ğŸ\nè‹¥è¼¸å…¥é‡è¤‡çš„è©å½™ç›´æ¥çµæŸã€‚',}));
			
	 conv.ask(new BasicCard({   
		title: 'ã€'+sys_word+'ã€',
		subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
		text:'_è‹¥é–‹é ­è©å¤ªé›£ï¼Œå¯ä»¥èªªã€Œé‡æ–°é–‹å§‹ã€_  \næˆ–è·³éå®ƒè®“æˆ‘å¹«ä½ æƒ³ä¸€å€‹è©å½™ï¼Œæ¯å›åˆå…±ä¸‰æ¬¡æ©Ÿæœƒ',}));
	conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','è·³éé€™å€‹è©','æ”¾æ£„æœ¬å›åˆ'));
	
	}else{
		//è½‰æ›å­—ä¸²ä¸­çš„ç•°é«”å­—
        if(last_word==="æº¼"){input=replaceString(input, 'æ¿•', 'æº¼');}
        else if(last_word==="å°"){input=replaceString(input, 'è‡º', 'å°');}
        else if(last_word==="è‡º"){input=replaceString(input, 'å°', 'è‡º');}
        else if(last_word==="æš®"){input=replaceString(input, 'ç›®', 'æš®');}
        else if(last_word==="å‰"){input=replaceString(input, 'å‰é›¢', 'ç»ç’ƒ');}
        else if(last_word==="åˆ»"){input=replaceString(input, 'å¯', 'åˆ»');}
        else if(last_word==="åˆ»"){input=replaceString(input, 'ç§‘', 'åˆ»');}
        else if(last_word==="ä¾‹"){input=replaceString(input, 'æ —', 'ä¾‹');}
        else if(last_word==="ç”±"){input=replaceString(input, 'é­·é­š', 'ç”±æ–¼');}
        else if(last_word==="å¯¢"){input=replaceString(input, 'è«‹ç¤º', 'å¯¢å®¤');}
        else if(last_word==="åˆ©"){input=replaceString(input, 'Z1', 'åˆ©ç›Š');}
        else if(last_word==="å·"){input=replaceString(input, 'å‘¨', 'å·');}
        else if(last_word==="æ–—"){input=replaceString(input, 'é¬¥', 'æ–—');}
        else if(last_word==="è¼©"){input=replaceString(input, 'å‚™', 'è¼©');}
        else if(last_word==="è±”"){input=replaceString(input, 'è±”', 'è‰·');}
		else if(last_word==="æº"){input=replaceString(input, 'åœ“', 'æº');}
		else if(last_word==="è©"){input=replaceString(input, 'æ…ˆæƒ ', 'è©å½™');}
        
		input=replaceString(input, '0', 'é›¶');
		input=replaceString(input, '1', 'ä¸€');
		input=replaceString(input, '2', 'äºŒ');
		input=replaceString(input, '3', 'ä¸‰');
		input=replaceString(input, '4', 'å››');
		input=replaceString(input, '5', 'äº”');
		input=replaceString(input, '6', 'å…­');
		input=replaceString(input, '7', 'ä¸ƒ');
		input=replaceString(input, '8', 'å…«');
		input=replaceString(input, '9', 'ä¹');
		
		input=replaceString(input, 'UB', 'å‹™å¿…');

		input_init=input.split('');
		first_word=input_init[0];
		
		checker=input_init.length;
	    conv.noInputs = ["æˆ‘å‰›å‰›èªªçš„æ˜¯"+sys_word+"ï¼Œè«‹èªªä»¥"+last_word+"ç‚ºé–‹é ­çš„è©å½™","ç¾åœ¨çš„è©å½™æ˜¯"+sys_word+"ï¼Œè«‹ç¹¼çºŒæ¥ä¸‹å»","æŠ±æ­‰ï¼Œç”±æ–¼æ‚¨ä¸€ç›´æ²’æœ‰å›æ‡‰ã€‚å› æ­¤éŠæˆ²åˆ°æ­¤çµæŸã€‚ä½ åœ¨é€™å›åˆé€²è¡Œ"+Total_Count+"æ¬¡æ¥é¾ï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹ã€‚"];	   

		if(isChn(input)===false){	
		wrong_count++;
		wrong_array=[`<speak><p><s>éŒ¯èª¤!</s><s>ä¸èƒ½å°‡ä¸­æ–‡ä»¥å¤–çš„å­—ç¬¦ä½œç‚ºè¼¸å…¥!</s></p></speak>`,
			`<speak><p><s>${input}åŒ…å«éæ³•å­—å…ƒï¼Œæ¯æ¹¯å–”!</s></p></speak>`,
			`<speak><p><s>å®‰ã„‹ã„ŸË‰æ¯æ¹¯ï¼Œè«‹æ›ä¸€å€‹è©ä¾†è©¦çœ‹çœ‹</s></p></speak>`,
			`<speak><p><s>${input}è£¡äº‚æ··å…¥æ€ªæ€ªçš„æ±è¥¿ï¼Œè«‹æ›ä¸€å€‹!</s></p></speak>`,						
			`<speak><p><s>é€™å€‹è©å½™è£¡æœ‰æ€ªæ€ªçš„æ±è¥¿ï¼Œè«‹æ›ä¸€å€‹ã€‚</s></p></speak>`,];

		conv.ask(new SimpleResponse({               
				speech:wrong_array[parseInt(Math.random()*4)],
				text: 'ä½ çš„è¼¸å…¥åŒ…å«ä¸­æ–‡å¤–çš„å­—ç¬¦',}));		
		if(conv.screen){
		 conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]éæ³•è¼¸å…¥ï¼Œä¸èƒ½åŠ å…¥è‹±æ–‡ç­‰éæ³•ç¬¦è™Ÿ!_',}));
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
		}else{
			if(wrong_count<=2){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>è«‹è©¦è‘—ç¹¼çºŒæ¥ä¸‹å»</s></p></speak>`);}
			else if(wrong_count<5){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>å¦‚æœä»æƒ³ä¸åˆ°å¯ä»¥æ¥ç”šéº¼è©å½™ï¼Œå¯ä»¥å°æˆ‘èªª<break time="0.2s"/>è·³éå®ƒ</s></p></speak>`);}
			else{conv.close(`<speak><p><s>ç”±æ–¼æˆ‘å€‘çš„å°è©±ç„¡æ³•ç¹¼çºŒï¼ŒéŠæˆ²å…ˆåˆ°é€™è£¡å…«<break time="0.2s"/>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
		}		}
		else{	
		if(checker===1){
		wrong_count++;
		wrong_array=[`<speak><p><s>éŒ¯èª¤!</s><s>ä¸èƒ½åªè¼¸å…¥ä¸€å€‹å­—!</s></p></speak>`,
			`<speak><p><s>${input}åªæœ‰ä¸€å€‹å­—ï¼Œæ¯æ¹¯å–”!</s></p></speak>`,
			`<speak><p><s>å®‰ã„‹ã„ŸË‰æ¯æ¹¯ï¼Œè«‹èªªè‡³å°‘æœ‰å…©çš„å­—çš„è©å½™</s></p></speak>`,
			`<speak><p><s>${input}åªæœ‰ä¸€å€‹å­—ï¼Œé€™æ¨£æ˜¯ä¸è¡Œçš„!</s></p></speak>`,						
			`<speak><p><s>é€™å€‹è©å½™åªæœ‰ä¸€å€‹å­—ï¼Œæˆ‘æ˜¯ä¸æœƒä¸Šç•¶çš„ã€‚</s></p></speak>`,];

		conv.ask(new SimpleResponse({               
		speech:wrong_array[parseInt(Math.random()*4)],
			text: 'ã€Œ'+input+'ã€åªæœ‰ä¸€å€‹å­—æ˜¯ä¸è¡Œçš„',}));
		if(conv.screen){
		conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ è‡³å°‘è¦è¼¸å…¥ç”±å…©å€‹å­—æ§‹æˆçš„è©èªã€‚_',}));
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
		 
		}else{
			if(wrong_count<=2){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>è«‹è©¦è‘—ç¹¼çºŒæ¥ä¸‹å»</s></p></speak>`);}
			else if(wrong_count<5){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>å¦‚æœä»æƒ³ä¸åˆ°å¯ä»¥æ¥ç”šéº¼è©å½™ï¼Œå¯ä»¥å°æˆ‘èªª<break time="0.2s"/>è·³éå®ƒ</s></p></speak>`);}
			else{conv.close(`<speak><p><s>ç”±æ–¼æˆ‘å€‘çš„å°è©±ç„¡æ³•ç¹¼çºŒï¼ŒéŠæˆ²å…ˆåˆ°é€™è£¡å…«<break time="0.2s"/>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
			}
		}
		else{		
		if(last_word!==first_word){
		wrong_count++;		
		repeat=false;
		
		wrong_array=[`<speak><p><s>æƒ³çš„å¥½ï¼Œä½†æ˜¯${input}çš„è‡ªé¦–ä¸æ˜¯${last_word}å–”!å†æƒ³ä¸€å€‹å…«!</s></p></speak>`,
			`<speak><p><s>${input}çš„å­—é¦–å¥½åƒã„…ã„¨ËŠå¤ªå°å–”ï¼Œè©¦è‘—æ›ä¸€å€‹å…«!</s></p></speak>`,
			`<speak><p><s>${input}çš„å­—é¦–å°ã„…ã„¨ËŠä¸Šå‘¢ï¼Œå†æƒ³ä¸€æƒ³å¾Œé ­å¯ä»¥æ¥ä»€éº¼è©å½™!</s></p></speak>`,
			`<speak><p><s>${input}çš„å­—é¦–ã„…ã„¨ËŠå¤ªå°ï¼Œæ›ä¸€å€‹è©¦çœ‹çœ‹!</s></p></speak>`,						
			`<speak><p><s>é€™å€‹æˆèªçš„å­—é¦–ä¸æ˜¯æˆ‘è¦çš„ï¼Œè«‹æ›ä¸€å€‹ã€‚</s></p></speak>`,];

		conv.ask(new SimpleResponse({               
		speech:wrong_array[parseInt(Math.random()*4)],
		text: 'ä¸å¥½æ„æ€ï¼Œè«‹å†è¬›ä¸€æ¬¡å¥½å—ï¼Ÿ',})); 
		
		if(conv.screen){	 
		if(conv.input.type==="VOICE"){  //å¦‚æœè¼¸å…¥æ˜¯èªéŸ³ï¼Œå‰‡é¡¯ç¤ºéŒ¯èª¤è™•ç†æ–¹æ³•
		conv.ask(new BasicCard({
				title: 'ã€'+sys_word+'ã€',
				subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
				text:'*ã€ˆéŒ¯èª¤èªªæ˜ã€‰*  \n*GoogleèªéŸ³è¾¨è­˜å¯èƒ½ç™¼ç”ŸéŒ¯èª¤ï¼Œä½ å¯ä»¥å˜—è©¦ï¼š*  \nâ€¢ è©¦è‘—å†èªªä¸€æ¬¡  \nâ€¢ è‹¥éŒ¯èª¤æºè‡ªåŒéŸ³è©è¾¨è­˜ï¼Œè«‹è©¦è‘—åŠ é•·è©å½™é•·åº¦  \nâ€¢ é€ééµç›¤è¼¸å…¥æ¬²è¡¨é”çš„è©å½™  \nâ€¢ å‘Googleå›å ±è©²éŒ¯èª¤æ”¹å–„å…¶è¾¨è­˜èƒ½åŠ›'})); 
   	     conv.ask(new Suggestions('æˆ‘è¦é€²è¡Œå›å ±'));
	    }
	    else{ //è¼¸å…¥æ–¹å¼ä¸æ˜¯èªéŸ³å‰‡é¡¯ç¤ºè¼¸å…¥éŒ¯èª¤

        conv.ask(new BasicCard({   
				title: 'ã€'+sys_word+'ã€',
				subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
				text:'_[!]è«‹è¼¸å…¥æ­£ç¢ºçš„é–‹é ­è©æ‰èƒ½ç¹¼çºŒé€²è¡Œå–”!_',}));
		  }
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
		}else{
			if(wrong_count<=2){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>è«‹è©¦è‘—ç¹¼çºŒæ¥ä¸‹å»</s></p></speak>`);}
			else if(wrong_count<5){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>å¦‚æœä»æƒ³ä¸åˆ°å¯ä»¥æ¥ç”šéº¼è©å½™ï¼Œå¯ä»¥å°æˆ‘èªª<break time="0.2s"/>è·³éå®ƒ</s></p></speak>`);}
			else{conv.close(`<speak><p><s>ç”±æ–¼æˆ‘å€‘çš„å°è©±ç„¡æ³•ç¹¼çºŒï¼ŒéŠæˆ²å…ˆåˆ°é€™è£¡å…«<break time="0.2s"/>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
		  }	
	  }
		else{
		Total_Count++;
		wrong_count=0;

	   if(input_list.indexOf(input)===-1){   //æª¢æŸ¥è¼¸å…¥çš„è©å½™æ˜¯å¦å·²é‡è¤‡
 
        input_list.push(input);//å°‡è©å½™å­˜å…¥ä½‡åˆ—
		input_word=input_init.pop();
		output_array=text_library[input_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
		
		if(typeof output_array==="undefined"){
	 	menu=false;question_output=false;end_game=true;reported=false; 
		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>å¯<break time="0.2s"/>å¯<break time="0.2s"/>å¯æƒ¡<break time="0.2s"/></s><s>æˆ‘ç«Ÿç„¶æ‰¾ä¸åˆ°å¯ä»¥æ¥ä¸‹å»çš„è©ï¼Œä½ è´æˆ‘äº†å‘¢!</s></p></speak>`,
			text: 'æˆ‘è¼¸äº† ğŸ˜±',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
			title: 'æˆ‘ä¸çŸ¥é“ã€'+input+'ã€å¾Œé¢è©²æ¥ä»€éº¼...',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
        Total_Count=0;input_list=[];start_game=false;}
		else{
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™
		 }	
		}
		else{
		sys_word=output_array[parseInt(Math.random()*(output_array.length-1))];
        last_word=sys_word.split('');
		last_word=last_word.pop();
        
		if(input_list.indexOf(sys_word)!==-1){
	 	menu=false;question_output=false;end_game=true;reported=false; 
		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>å¯æƒ¡</s><s>æˆ‘ä¸å°å¿ƒèªªäº†æ›¾ç¶“èªªéçš„è©ï¼Œä½ è´æˆ‘äº†å‘¢!</s></p></speak>`,
			text: 'æˆ‘è¼¸äº† ğŸ˜±',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
			title: 'æ²’æƒ³åˆ°ã€'+sys_word+'ã€å·²ç¶“èªªéäº†',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
		Total_Count=0;input_list=[];start_game=false;
		}else{
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™
	   	 }
		}
		else{
		
		input_list.push(sys_word);//å°‡è©å½™å­˜å…¥ä½‡åˆ—
        output_array=text_library[last_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
		 
	 if(typeof output_array==="undefined"){
	 	menu=false;question_output=false;end_game=true;reported=false; 

		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>ç³Ÿç³•<break time="0.2s"/>æˆ‘æ‰€æƒ³çš„${sys_word}æ˜¯æ²’è¾¦æ³•æ¥ä¸‹å»çš„!å›åˆçµæŸ!</s></p></speak>`,
			text: 'æˆ‘æ‰€æƒ³çš„è©æ˜¯æ¥ä¸ä¸‹å»çš„ï¼Œ\nå› æ­¤å›åˆçµæŸæ‹‰!',}));

		if(conv.screen){	
		conv.ask(new BasicCard({   
            title: 'æˆ‘æƒ³çš„ã€'+sys_word+'ã€æ¥ä¸ä¸‹å»æ‹‰!',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'ä½ å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
		Total_Count=0;input_list=[];start_game=false;
		}else{
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™
		}	
	   }
		   else{
	     conv.ask(new SimpleResponse({               
						speech: `<speak><p><s>${sys_word}</s></p></speak>`,
						text: return_array[parseInt(Math.random()*4)],}));

		 conv.noInputs = ["æˆ‘å‰›å‰›èªªçš„æ˜¯"+sys_word+"ï¼Œè«‹èªªä»¥"+last_word+"ç‚ºé–‹é ­çš„è©å½™","ç¾åœ¨çš„è©å½™æ˜¯"+sys_word+"ï¼Œè«‹ç¹¼çºŒæ¥ä¸‹å»","æŠ±æ­‰ï¼Œç”±æ–¼æ‚¨ä¸€ç›´æ²’æœ‰å›æ‡‰ã€‚å› æ­¤éŠæˆ²åˆ°æ­¤çµæŸã€‚ä½ åœ¨é€™å›åˆé€²è¡Œ"+Total_Count+"æ¬¡æ¥é¾ï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹ã€‚"];	   

		 conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ ç›®å‰å‰©ä¸‹'+(3-jumpcount)+'æ¬¡è·³éæ©Ÿæœƒ_',}));
	   
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
       } 		
      }
	 }
	}else{
	 	menu=false;question_output=false;end_game=true;reported=false; 
        
		last_word=input.split('');
		last_word=last_word[0];
        output_array=text_library[last_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
		sys_suggest=output_array[parseInt(Math.random()*(output_array.length-1))];

		   if(typeof output_array==="undefined"){subtitle_suggest='æˆ‘æ‰¾ä¸åˆ°...';}
										    else{subtitle_suggest='æœ‰ã€'+sys_suggest+'ã€ã€‚';}

        conv.ask(new SimpleResponse({               
					speech: `<speak><p><s>å±…å±…<break time="0.2s"/>ä½ è¼¸å…¥çš„${input}é‡è¤‡å›‰!</s><s>å›åˆçµæŸ!</s></p></speak>`,
					text: 'ä½ è¼¸å…¥é‡è¤‡çš„è©ï¼Œå› æ­¤å›åˆçµæŸæ‹‰!',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
			title: 'ã€'+input+'ã€å·²ç¶“è¼¸å…¥éå›‰!',
			subtitle:'æœ¬å›åˆå·²çµæŸ â€¢ å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾\n\nâœ®å¢å¼·åŠŸåŠ›ï¼š\nä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™'+subtitle_suggest, 
			buttons: new Button({title:'åœ¨ã€ŠèŒå…¸ã€‹ä¸Šçœ‹ã€Œ'+last_word+'ã€çš„ç”¨æ³•',
								 url: 'https://www.moedict.tw/'+last_word,}), 		
			}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
		Total_Count=0;input_list=[];start_game=false;
		}else{
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™	
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
       }	
	  } 
	 }
	} 
   }
  }
  else if(menu===false&&end_game===false&&question_output===true&&reported===true){
    reported=false;
        conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>å¥½çš„!æˆ‘å‰›å‰›èªªçš„æ˜¯<break time="0.2s"/>${sys_word}ï¼Œç¹¼çºŒæ¥ä¸‹å»å…«!</s></p></speak>`,
			text: 'OKï¼Œæˆ‘å€‘ç¹¼çºŒé€²è¡Œ!',}));
			
		 conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ ç›®å‰å‰©ä¸‹'+(3-jumpcount)+'æ¬¡è·³éæ©Ÿæœƒ_',}));
	   
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
	  }
  else if(menu===false&&end_game===true&&question_output===true&&reported===true){
	 	menu=false;question_output=false;end_game=true;reported=false; 
     conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>ä½ çš„å›åˆå·²ç¶“çµæŸäº†ï¼Œè«‹å•ä½ é‚„è¦å†ç©ä¸€æ¬¡å—?</s></p></speak>`,
			text: 'è«‹å•ä½ é‚„è¦å†ç©ä¸€æ¬¡å—?',}));
     conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
  }
  else if(menu===false&&end_game===true&&question_output===false&&reported===false){
    conv.ask(new SimpleResponse(
	{speech:`<speak><p><s>ä¸å¥½æ„æ€ï¼Œæˆ‘æ²’è½æ¸…æ¥šã€‚\n</s><s>è«‹è©¦è‘—èªª<break time="0.2s"/>é‡æ–°é–‹å§‹<break time="0.2s"/>æˆ–<break time="0.2s"/>æ°æ°<break time="0.2s"/>ä¾†ç¢ºèªä½ çš„æ“ä½œã€‚</s></p></speak>`,
	text: 'æŠ±æ­‰ï¼Œæˆ‘ä¸æ‡‚ä½ çš„æ„æ€ã€‚\nè«‹é»æ“Šå»ºè­°å¡ç‰‡ä¾†ç¢ºèªä½ çš„æ“ä½œã€‚'}));
	conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
  }else{ 	 conv.ask(new SimpleResponse({               
                      speech: "æœ¬æœå‹™éœ€è¦æ‚¨é€²ä¸€æ­¥é€²è¡Œè¨­å®šæ‰èƒ½ç¹¼çºŒé€²è¡Œï¼Œè«‹ä¾ç…§ä¸‹è¿°æ­¥é©Ÿé–‹å•Ÿã€Œç¶²è·¯èˆ‡æ‡‰ç”¨ç¨‹å¼ã€åŠŸèƒ½ã€‚æ‰èƒ½ç²å¾—å€‹äººåŒ–é«”é©—å–”!",
                       text: 'è«‹é€²è¡Œç›¸é—œè¨­å®šï¼Œæ‰èƒ½é€²è¡ŒéŠæˆ²!',}));
	   conv.close(new BasicCard({   
			image: new Image({url:'https://i.imgur.com/P5FWCbe.png',alt:'Pictures',}),
			title: 'éŒ¯èª¤ï¼šæ‚¨éœ€è¦é€²è¡Œè¨­å®š',
			subtitle:'ç‚ºäº†çµ¦æ‚¨å€‹äººåŒ–çš„éŠæˆ²é«”é©—ï¼Œè«‹é€²è¡Œè¨­å®šã€‚\n\n1. é»æ“Šä¸‹æ–¹æŒ‰éˆ•å‰å¾€Googleå¸³æˆ¶è¨­å®š\n2.	é–‹å•Ÿã€Œç¶²è·¯å’Œæ‡‰ç”¨ç¨‹å¼æ´»å‹•ã€åŠŸèƒ½\n3.	é–‹å•Ÿã€ŒåŒ…æ‹¬ Chrome ç€è¦½è¨˜éŒ„ä»¥åŠæ¡ç”¨ Google æœå‹™çš„ç¶²ç«™ã€æ‡‰ç”¨ç¨‹å¼å’Œè£ç½®ä¸­çš„æ´»å‹•è¨˜éŒ„ã€\n', 
			buttons: new Button({title: 'Googleæ´»å‹•æ§åˆ¶é …',url:"https://myaccount.google.com/activitycontrols?pli=1",}),
			display: 'CROPPED',
		}));
}
	}else{
		conv.ask(new SimpleResponse({               
                      speech: "åœ¨é–‹å§‹å‰ï¼Œæ‚¨éœ€è¦å•Ÿç”¨GoogleåŠ©ç†ï¼Œæˆ‘æ‰èƒ½æä¾›ä½ å€‹äººåŒ–é«”é©—å–”!",
                       text: 'è«‹é€²è¡Œç›¸é—œè¨­å®šï¼Œæ‰èƒ½é€²è¡ŒéŠæˆ²!',}));
	   conv.close(new BasicCard({   
			image: new Image({url:'https://www.gstatic.com/images/branding/product/2x/assistant_48dp.png',alt:'Pictures',}),
			title: 'éŒ¯èª¤ï¼šæ‚¨éœ€è¦é€²è¡Œè¨­å®š',
			subtitle:'Google åŠ©ç†éœ€è¦æˆæ¬Š(è«‹é»æ“Šã€Œé–‹å§‹ä½¿ç”¨ã€)ã€‚\næˆæ¬Šå¾Œæˆ‘æ‰èƒ½ç‚ºä½ å„²å­˜å€‹äººå°è©±ç‹€æ…‹ï¼Œ\nè—‰æ­¤æå‡ä½ çš„ä½¿ç”¨é«”é©—!\n', 
			display: 'CROPPED',
		}));}

 conv.user.storage.menu=menu;
 conv.user.storage.end_game=end_game;
 conv.user.storage.question_output=question_output;
 conv.user.storage.sys_word=sys_word;
 conv.user.storage.last_word=last_word;
 conv.user.storage.input_list=input_list;
 conv.user.storage.Total_Count=Total_Count;
 conv.user.storage.start_game=start_game;
 conv.user.storage.reported=reported;
 conv.user.storage.jumpcount=jumpcount;
 conv.user.storage.wrong_count=wrong_count;

});

app.intent('å›å ±è¾¨è­˜éŒ¯èª¤', (conv) => {
 menu=conv.user.storage.menu;
 end_game=conv.user.storage.end_game;
 question_output=conv.user.storage.question_output;
 last_word=conv.user.storage.last_word;
 sys_word=conv.user.storage.sys_word;
 input_list=conv.user.storage.input_list;
 Total_Count=conv.user.storage.Total_Count;
 start_game=conv.user.storage.start_game;
 reported=conv.user.storage.reported;
     
     reported=true;
  if(menu===false&&end_game===true&&question_output===false){question_output=true;}

      conv.ask(new SimpleResponse({               
					speech: `<speak><p><s>æœ¬æœå‹™çš„èªéŸ³è¾¨è­˜ç”±GoogleåŸ·è¡Œï¼Œè‹¥ç™¼ç”ŸéŒ¯èª¤è«‹ä¾ç…§ä¸‹æ–¹èªªæ˜é€²è¡Œåé¥‹!</s></p></speak>`,
					text: 'è«‹ä¾ç…§ä¸‹æ–¹èªªæ˜é€²è¡Œåé¥‹ã€‚',}));

      conv.ask(new BasicCard({   
			image: new Image({url:'https://www.gstatic.com/myactivity/udc/vaa-720x300-22c8ffadc520f71278ef6a567753598f.png',alt:'Pictures',}),
			title: 'åé¥‹æµç¨‹èªªæ˜',
			subtitle:'1. å‰å¾€Googleå¸³æˆ¶è¨­å®š(ä¸‹æ–¹æŒ‰éˆ•)\n2.	æŸ¥çœ‹è¼¸å…¥ç´€éŒ„ï¼ŒæŸ¥æ‰¾è¾¨è­˜éŒ¯èª¤çš„é …ç›®\n3.é¸å–å³æ–¹çš„ã€Œæ›´å¤šã€åœ–ç¤º > [è©³ç´°è³‡è¨Š] \n4.é¸å–å³æ–¹çš„ã€Œæ›´å¤šã€åœ–ç¤º > [æä¾›æ„è¦‹] \n5.æ’°å¯«æ‚¨çš„æ„è¦‹ä¸¦æäº¤çµ¦Google', 
			buttons: new Button({title:'Google åŠ©ç†æ´»å‹•',
								 url: 'https://myactivity.google.com/item?restrict=assist&hl=zh_TW&utm_source=privacy-advisor-assistant&embedded=1&pli=1',}), 		
            display: 'CROPPED',
			}));
      conv.ask(new Suggestions('ç¹¼çºŒé€²è¡Œæ¥é¾','æ”¾æ£„æœ¬å›åˆ'));

 conv.user.storage.menu=menu;
 conv.user.storage.end_game=end_game;
 conv.user.storage.question_output=question_output;
 conv.user.storage.sys_word=sys_word;
 conv.user.storage.last_word=last_word;
 conv.user.storage.input_list=input_list;
 conv.user.storage.Total_Count=Total_Count;
 conv.user.storage.start_game=start_game;
 conv.user.storage.reported=reported;

});

app.intent('ç¹¼çºŒé€²è¡Œ', (conv) => {
 menu=conv.user.storage.menu;
 end_game=conv.user.storage.end_game;
 question_output=conv.user.storage.question_output;
 last_word=conv.user.storage.last_word;
 sys_word=conv.user.storage.sys_word;
 input_list=conv.user.storage.input_list;
 Total_Count=conv.user.storage.Total_Count;
 start_game=conv.user.storage.start_game;
 reported=conv.user.storage.reported;

  if(menu===false&&end_game===false&&question_output===true&&reported===true){
    reported=false;
	    conv.noInputs = ["æˆ‘å‰›å‰›èªªçš„æ˜¯"+sys_word+"ï¼Œè«‹èªªä»¥"+last_word+"ç‚ºé–‹é ­çš„è©å½™","ç¾åœ¨çš„è©å½™æ˜¯"+sys_word+"ï¼Œè«‹ç¹¼çºŒæ¥ä¸‹å»","æŠ±æ­‰ï¼Œç”±æ–¼æ‚¨ä¸€ç›´æ²’æœ‰å›æ‡‰ã€‚å› æ­¤éŠæˆ²åˆ°æ­¤çµæŸã€‚ä½ åœ¨é€™å›åˆé€²è¡Œ"+Total_Count+"æ¬¡æ¥é¾ï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹ã€‚"];	   

		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>å¥½çš„!æˆ‘å‰›å‰›èªªçš„æ˜¯<break time="0.2s"/>${sys_word}ï¼Œç¹¼çºŒæ¥ä¸‹å»å…«!</s></p></speak>`,
			text: 'OKï¼Œæˆ‘å€‘ç¹¼çºŒé€²è¡Œ!',}));
			
		 conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ ç›®å‰å‰©ä¸‹'+(3-jumpcount)+'æ¬¡è·³éæ©Ÿæœƒ_',}));
	   
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
  }
 else if(menu===false&&end_game===true&&question_output===true&&reported===true){
	 	menu=false;question_output=false;end_game=true;reported=false; 
     conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>ä½ çš„å›åˆå·²ç¶“çµæŸäº†ï¼Œè«‹å•ä½ é‚„è¦å†ç©ä¸€æ¬¡å—?</s></p></speak>`,
			text: 'è«‹å•ä½ é‚„è¦å†ç©ä¸€æ¬¡å—?',})); 
     conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));

  }else{ 	 conv.ask(new SimpleResponse({               
                      speech: "æœ¬æœå‹™éœ€è¦æ‚¨é€²ä¸€æ­¥é€²è¡Œè¨­å®šæ‰èƒ½ç¹¼çºŒé€²è¡Œï¼Œè«‹ä¾ç…§ä¸‹è¿°æ­¥é©Ÿé–‹å•Ÿã€Œç¶²è·¯èˆ‡æ‡‰ç”¨ç¨‹å¼ã€åŠŸèƒ½ã€‚æ‰èƒ½ç²å¾—å€‹äººåŒ–é«”é©—å–”!",
                       text: 'è«‹é€²è¡Œç›¸é—œè¨­å®šï¼Œæ‰èƒ½é€²è¡ŒéŠæˆ²!',}));
	   conv.close(new BasicCard({   
			image: new Image({url:'https://i.imgur.com/P5FWCbe.png',alt:'Pictures',}),
			title: 'éŒ¯èª¤ï¼šæ‚¨éœ€è¦é€²è¡Œè¨­å®š',
			subtitle:'ç‚ºäº†çµ¦æ‚¨å€‹äººåŒ–çš„éŠæˆ²é«”é©—ï¼Œè«‹é€²è¡Œä¸‹è¿°è¨­å®šï¼š\n\n1. å‰å¾€Googleå¸³æˆ¶è¨­å®š\n2.	é–‹å•Ÿã€Œç¶²è·¯å’Œæ‡‰ç”¨ç¨‹å¼æ´»å‹•ã€åŠŸèƒ½\n3.	é–‹å•Ÿã€ŒåŒ…æ‹¬ Chrome ç€è¦½è¨˜éŒ„ä»¥åŠæ¡ç”¨ Google æœå‹™çš„ç¶²ç«™ã€æ‡‰ç”¨ç¨‹å¼å’Œè£ç½®ä¸­çš„æ´»å‹•è¨˜éŒ„ã€\n', 
			buttons: new Button({title: 'Googleæ´»å‹•æ§åˆ¶é …',url:"https://myaccount.google.com/activitycontrols?pli=1",}),
			display: 'CROPPED',
		}));

}
 conv.user.storage.menu=menu;
 conv.user.storage.end_game=end_game;
 conv.user.storage.question_output=question_output;
 conv.user.storage.sys_word=sys_word;
 conv.user.storage.last_word=last_word;
 conv.user.storage.input_list=input_list;
 conv.user.storage.Total_Count=Total_Count;
 conv.user.storage.start_game=start_game;
 conv.user.storage.reported=reported;

});

app.intent('çµæŸæŒ‘æˆ°', (conv,{end_game}) => {

 menu=conv.user.storage.menu;
 end_game=conv.user.storage.end_game;
 question_output=conv.user.storage.question_output;
 last_word=conv.user.storage.last_word;
 sys_word=conv.user.storage.sys_word;
 input_list=conv.user.storage.input_list;
 Total_Count=conv.user.storage.Total_Count;
 start_game=conv.user.storage.start_game;
 reported=conv.user.storage.reported;
 jumpcount=conv.user.storage.jumpcount;

	menu=false;question_output=false;end_game=true;reported=false; 
	
	output_array=text_library[last_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
 
   if(typeof output_array==="undefined"){subtitle_suggest='æˆ‘æ‰¾ä¸åˆ°...';}
   else{
	sys_word=output_array[parseInt(Math.random()*(output_array.length-1))];
	subtitle_suggest='æœ‰ã€'+sys_word+'ã€ã€‚';}

  if(typeof Total_Count!=="undefined"){

	if(conv.screen){	
	  conv.ask(new SimpleResponse({speech:`<speak><p><s>ä½ åœ¨é€™å›åˆä¸€å…±é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ã€‚</s><s>ä½ è¦å†è©¦ä¸€æ¬¡å—?</s></p></speak>`,text: 'é©—æ”¶æˆæœ'}));
	  
  conv.ask(new BasicCard({   
        image: new Image({url:'https://imgur.com/2oOhmvs.jpg',alt:'Pictures',}),
        title: 'æœ¬å›åˆå…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾',
		subtitle:'ä¸è¨ˆå…¥è·³éçš„è©å½™',
        text:'âœ®å¢å¼·åŠŸåŠ›ï¼š  \nä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™'+subtitle_suggest, 
		buttons: new Button({title:'åœ¨ã€ŠèŒå…¸ã€‹ä¸Šçœ‹ã€Œ'+last_word+'ã€çš„ç”¨æ³•',
								 url: 'https://www.moedict.tw/'+last_word,}), 
        display: 'CROPPED',//æ›´æ”¹åœ–ç‰‡é¡¯ç¤ºæ¨¡å¼ç‚ºè‡ªå‹•æ“´å±•
       })); 
	conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
		}else{
		subtitle_suggest=replaceString(subtitle_suggest, 'ã€', '<break time="0.3s"/>ã€');
		conv.close(new SimpleResponse({speech:`<speak><p><s>ä»¥${last_word}é–‹é ­çš„è©å½™${subtitle_suggest}</s><s>ä½ åœ¨æœ¬å›åˆå…±é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ã€‚</s><s>ä¸‹æ¬¡è¦‹!</s></p></speak>`,text: 'é©—æ”¶æˆæœ'}));
  }

  }else{ 	 conv.ask(new SimpleResponse({               
                      speech: "æœ¬æœå‹™éœ€è¦æ‚¨é€²ä¸€æ­¥é€²è¡Œè¨­å®šæ‰èƒ½ç¹¼çºŒé€²è¡Œï¼Œè«‹ä¾ç…§ä¸‹è¿°æ­¥é©Ÿé–‹å•Ÿã€Œç¶²è·¯èˆ‡æ‡‰ç”¨ç¨‹å¼ã€åŠŸèƒ½ã€‚æ‰èƒ½ç²å¾—å€‹äººåŒ–é«”é©—å–”!",
                       text: 'è«‹é€²è¡Œç›¸é—œè¨­å®šï¼Œæ‰èƒ½é€²è¡ŒéŠæˆ²!',}));
	   conv.close(new BasicCard({   
        title: 'éŒ¯èª¤ï¼šæ‚¨éœ€è¦é€²è¡Œè¨­å®š',
        subtitle:'ç‚ºäº†çµ¦æ‚¨å€‹äººåŒ–çš„éŠæˆ²é«”é©—ï¼Œè«‹é€²è¡Œè¨­å®šï¼š\n\n1. å‰å¾€Googleå¸³æˆ¶è¨­å®š\n2.	é–‹å•Ÿã€Œç¶²è·¯å’Œæ‡‰ç”¨ç¨‹å¼æ´»å‹•ã€åŠŸèƒ½\n3.	é–‹å•Ÿã€ŒåŒ…æ‹¬ Chrome ç€è¦½è¨˜éŒ„ä»¥åŠæ¡ç”¨ Google æœå‹™çš„ç¶²ç«™ã€æ‡‰ç”¨ç¨‹å¼å’Œè£ç½®ä¸­çš„æ´»å‹•è¨˜éŒ„ã€\n', 
         buttons: new Button({title: 'Googleæ´»å‹•æ§åˆ¶é …',url:"https://myaccount.google.com/activitycontrols?pli=1",}),

		}));

}
 conv.user.storage.menu=menu;
 conv.user.storage.end_game=end_game;
 conv.user.storage.question_output=question_output;
 conv.user.storage.sys_word=sys_word;
 conv.user.storage.last_word=last_word;
 conv.user.storage.input_list=input_list;
 conv.user.storage.Total_Count=Total_Count;
 conv.user.storage.start_game=start_game;
 conv.user.storage.reported=reported;
 conv.user.storage.jumpcount=jumpcount;

});

app.intent('è·³éé¡Œç›®', (conv) => {
	
 menu=conv.user.storage.menu;
 end_game=conv.user.storage.end_game;
 question_output=conv.user.storage.question_output;
 last_word=conv.user.storage.last_word;
 sys_word=conv.user.storage.sys_word;
 input_list=conv.user.storage.input_list;
 Total_Count=conv.user.storage.Total_Count;
 start_game=conv.user.storage.start_game;
 reported=conv.user.storage.reported;
 jumpcount=conv.user.storage.jumpcount;
 
 jumpcount++;

 if(jumpcount<=3){

	if((3-jumpcount)!==0){
    conv.ask(new SimpleResponse({
			speech:`<speak><p><s>å¥½çš„</s><s>ä½ ç¾åœ¨å‰©ä¸‹${3-jumpcount}æ¬¡è·³ã„ã„¨ã„›Ë‹çš„æ©Ÿæœƒ!</s></p></speak>`,
			text: 'å¥½çš„ï¼Œä½ é‚„æœ‰'+(3-jumpcount)+'æ¬¡è·³éçš„æ©Ÿæœƒ'}));}
	else{
    conv.ask(new SimpleResponse({
			speech:`<speak><p><s>æé†’ä½ </s><s>ä½ å·²ç¶“ç”¨å®Œæ‰€æœ‰è·³ã„ã„¨ã„›Ë‹çš„æ©Ÿæœƒ!</s></p></speak>`,
			text: 'ä½ å·²ç¶“ç”¨å®Œæ‰€æœ‰è·³éçš„æ©Ÿæœƒ'}));}
 
		output_array=text_library[last_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
		
		if(typeof output_array==="undefined"){
	 	menu=false;question_output=false;end_game=true;reported=false; 
		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>çœ‹ä¾†é€™å€‹è©å½™æ˜¯æ¥ä¸ä¸‹å»çš„ï¼Œå›åˆçµæŸ!</s></p></speak>`,
			text: 'é€™å€‹è©æ˜¯æ¥ä¸ä¸‹å»çš„ï¼Œå›åˆçµæŸ',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
			title: 'çœ‹ä¾†ã€'+sys_think+'ã€æ˜¯æ¥ä¸ä¸‹å»çš„',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
        Total_Count=0;input_list=[];start_game=false;
		}else{
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™	
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
			
		}
		else{
		var pre_word=sys_word;
		sys_word=output_array[parseInt(Math.random()*(output_array.length-1))];
        last_word=sys_word.split('');
		last_word=last_word.pop();
        
		if(input_list.indexOf(sys_word)!==-1){
	 	menu=false;question_output=false;end_game=true;reported=false; 
		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>ç³Ÿç³•</s><s>æˆ‘ä¸å°å¿ƒé¸äº†æ›¾ç¶“èªªéçš„è©ï¼Œå›åˆçµæŸ!</s></p></speak>`,
			text: 'å›åˆå·²çµæŸ',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€æ˜¯èªªéçš„è©',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
        Total_Count=0;input_list=[];start_game=false;
		}else{
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™	
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
		}
		else{
		
		input_list.push(sys_word);//å°‡è©å½™å­˜å…¥ä½‡åˆ—
        output_array=text_library[last_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
		 
	 if(typeof output_array==="undefined"){
	 	menu=false;question_output=false;end_game=true;reported=false; 

		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>ç³Ÿç³•<break time="0.2s"/>æˆ‘æ‰€é¸çš„${sys_word}æ˜¯æ²’è¾¦æ³•æ¥ä¸‹å»çš„!å›åˆçµæŸ!</s></p></speak>`,
			text: 'æˆ‘æ‰€æƒ³çš„è©æ˜¯æ¥ä¸ä¸‹å»çš„ï¼Œ\nå› æ­¤å›åˆçµæŸæ‹‰!',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
            title: 'æˆ‘æƒ³çš„ã€'+sys_word+'ã€æ¥ä¸ä¸‹å»æ‹‰!',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'ä½ å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
        Total_Count=0;input_list=[];start_game=false;
		}else{
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™	
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
		   }
		   else{
	     conv.ask(new SimpleResponse({               
						speech: `<speak><p><s>${pre_word}å¾Œé ­å¯ä»¥æ¥${sys_word}<break time="0.5s"/>æ¥è‘—ï¼Œè«‹ä½ ç¹¼çºŒæ¥ä¸‹å»</s></p></speak>`,
						text: "ã€Œ"+pre_word+"ã€å¯ä»¥æ¥ã€Œ"+sys_word+"ã€ï¼Œ \nè«‹è©¦è‘—ç¹¼çºŒæ¥ä¸‹å»ã€‚",}));
	     conv.noInputs = ["æˆ‘å‰›å‰›èªªçš„æ˜¯"+sys_word+"ï¼Œè«‹èªªä»¥"+last_word+"ç‚ºé–‹é ­çš„è©å½™","ç¾åœ¨çš„è©å½™æ˜¯"+sys_word+"ï¼Œè«‹ç¹¼çºŒæ¥ä¸‹å»","æŠ±æ­‰ï¼Œç”±æ–¼æ‚¨ä¸€ç›´æ²’æœ‰å›æ‡‰ã€‚å› æ­¤éŠæˆ²åˆ°æ­¤çµæŸã€‚ä½ åœ¨é€™å›åˆé€²è¡Œ"+Total_Count+"æ¬¡æ¥é¾ï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹ã€‚"];	   
		
		 conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ ç›®å‰å‰©ä¸‹'+(3-jumpcount)+'æ¬¡è·³éæ©Ÿæœƒ_',}));
	   
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
       } 
      }
	 }
 }
 else{
	 
	menu=false;question_output=false;end_game=true;reported=false; 
	
	output_array=text_library[last_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
  
   if(typeof output_array==="undefined"){subtitle_suggest='æˆ‘æ‰¾ä¸åˆ°...';}
   else{
	sys_word=output_array[parseInt(Math.random()*(output_array.length-1))];
	subtitle_suggest='æœ‰ã€'+sys_word+'ã€ã€‚';}
	 
	if(conv.screen){	
	  conv.ask(new SimpleResponse({speech:`<speak><p><s>ä½ åœ¨é€™å›åˆä¸€å…±é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ã€‚</s><s>ä½ è¦å†è©¦ä¸€æ¬¡å—?</s></p></speak>`,text: 'é©—æ”¶æˆæœ'}));
	  
  conv.ask(new BasicCard({   
        image: new Image({url:'https://imgur.com/2oOhmvs.jpg',alt:'Pictures',}),
        title: 'æœ¬å›åˆå…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾',
		subtitle:'ä¸è¨ˆå…¥è·³éçš„è©å½™',
        text:'âœ®å¢å¼·åŠŸåŠ›ï¼š  \nä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™'+subtitle_suggest, 
		buttons: new Button({title:'åœ¨ã€ŠèŒå…¸ã€‹ä¸Šçœ‹ã€Œ'+last_word+'ã€çš„ç”¨æ³•',
								 url: 'https://www.moedict.tw/'+last_word,}), 
        display: 'CROPPED',//æ›´æ”¹åœ–ç‰‡é¡¯ç¤ºæ¨¡å¼ç‚ºè‡ªå‹•æ“´å±•
       })); 
	conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
		}else{
		subtitle_suggest=replaceString(subtitle_suggest, 'ã€', '<break time="0.3s"/>ã€');
		conv.close(new SimpleResponse({speech:`<speak><p><s>ä»¥${last_word}é–‹é ­çš„è©å½™${subtitle_suggest}</s><s>ä½ åœ¨æœ¬å›åˆå…±é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ã€‚</s><s>ä¸‹æ¬¡è¦‹!</s></p></speak>`,text: 'é©—æ”¶æˆæœ'}));
  }
 }
 
 conv.user.storage.menu=menu;
 conv.user.storage.end_game=end_game;
 conv.user.storage.question_output=question_output;
 conv.user.storage.sys_word=sys_word;
 conv.user.storage.last_word=last_word;
 conv.user.storage.input_list=input_list;
 conv.user.storage.Total_Count=Total_Count;
 conv.user.storage.start_game=start_game;
 conv.user.storage.reported=reported;
 conv.user.storage.jumpcount=jumpcount;

});

app.intent('çµæŸå°è©±', (conv) => {
	
 menu=conv.user.storage.menu;
 end_game=conv.user.storage.end_game;
 question_output=conv.user.storage.question_output;
 last_word=conv.user.storage.last_word;
 sys_word=conv.user.storage.sys_word;
 input_list=conv.user.storage.input_list;
 Total_Count=conv.user.storage.Total_Count;
 start_game=conv.user.storage.start_game;
 reported=conv.user.storage.reported;
 jumpcount=conv.user.storage.jumpcount;

 var input=conv.input.raw;
 conv.noInputs = ["æˆ‘å‰›å‰›èªªçš„æ˜¯"+sys_word+"ï¼Œè«‹èªªä»¥"+last_word+"ç‚ºé–‹é ­çš„è©å½™","ç¾åœ¨çš„è©å½™æ˜¯"+sys_word+"ï¼Œè«‹ç¹¼çºŒæ¥ä¸‹å»","æŠ±æ­‰ï¼Œç”±æ–¼æ‚¨ä¸€ç›´æ²’æœ‰å›æ‡‰ã€‚å› æ­¤éŠæˆ²åˆ°æ­¤çµæŸã€‚ä½ åœ¨é€™å›åˆé€²è¡Œ"+Total_Count+"æ¬¡æ¥é¾ï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹ã€‚"];	   
 
  if(menu===false&&end_game===false&&question_output===true&&reported===false){
	  
  if((input==='é‡æ–°é–‹å§‹'||input==='ğŸ”„ é‡æ–°é–‹å§‹')&&Total_Count===0){input_list=[];start_game=false;reported=false;jumpcount=0;}

	if(start_game===false){
		start_game=true;jumpcount=0;

		//é¸å‡ºæœ€ä¸€é–‹å§‹çš„è©ï¼ŒåŒæ™‚åŸ·è¡Œé©—è­‰çœ‹æ˜¯å¦èƒ½æ¥ä¸‹å»
       //è‹¥æ˜¯ä¸è¡Œå‰‡é‡æ–°æŒ‘é¸ä¸€å€‹å­—	   
		number=parseInt(Math.random()*159)
		sys_word=text_start[number];   
        last_word=sys_word.split('');
		last_word=last_word.pop();
		
        input_list.push(sys_word);//å°‡è©å½™å­˜å…¥ä½‡åˆ—
		
	   	conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>é–‹å§‹å•¦!</s><s>ç¬¬ä¸€å€‹è©å½™æ˜¯<break time="0.2s"/>${sys_word}</s></p></speak>`,
			text: 'é–‹å§‹å•¦ğŸ\nè‹¥è¼¸å…¥é‡è¤‡çš„è©å½™ç›´æ¥çµæŸã€‚',}));
			
	 conv.ask(new BasicCard({   
		title: 'ã€'+sys_word+'ã€',
		subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
		text:'_[!]è‹¥é–‹é ­è©å¤ªé›£ï¼Œå¯ä»¥èªªã€Œé‡æ–°é–‹å§‹ã€_',}));
	conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','æ”¾æ£„æœ¬å›åˆ'));

	}else{       
		input=replaceString(input, '0', 'é›¶');
		input=replaceString(input, '1', 'ä¸€');
		input=replaceString(input, '2', 'äºŒ');
		input=replaceString(input, '3', 'ä¸‰');
		input=replaceString(input, '4', 'å››');
		input=replaceString(input, '5', 'äº”');
		input=replaceString(input, '6', 'å…­');
		input=replaceString(input, '7', 'ä¸ƒ');
		input=replaceString(input, '8', 'å…«');
		input=replaceString(input, '9', 'ä¹');

		input_init=input.split('');
		first_word=input_init[0];
		
		checker=input_init.length;

		if(isChn(input)===false){	

		wrong_array=[`<speak><p><s>éŒ¯èª¤!</s><s>ä¸èƒ½å°‡ä¸­æ–‡ä»¥å¤–çš„å­—ç¬¦ä½œç‚ºè¼¸å…¥!</s></p></speak>`,
			`<speak><p><s>${input}åŒ…å«éæ³•å­—å…ƒï¼Œæ¯æ¹¯å–”!</s></p></speak>`,
			`<speak><p><s>å®‰ã„‹ã„ŸË‰æ¯æ¹¯ï¼Œè«‹æ›ä¸€å€‹è©ä¾†è©¦çœ‹çœ‹</s></p></speak>`,
			`<speak><p><s>${input}è£¡äº‚æ··å…¥æ€ªæ€ªçš„æ±è¥¿ï¼Œè«‹æ›ä¸€å€‹!</s></p></speak>`,						
			`<speak><p><s>é€™å€‹è©å½™è£¡æœ‰æ€ªæ€ªçš„æ±è¥¿ï¼Œè«‹æ›ä¸€å€‹ã€‚</s></p></speak>`,];

		conv.ask(new SimpleResponse({               
		speech:wrong_array[parseInt(Math.random()*4)],
		text: 'ä½ çš„è¼¸å…¥åŒ…å«ä¸­æ–‡å¤–çš„å­—ç¬¦',}));
		if(conv.screen){
		conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ ç›®å‰å‰©ä¸‹'+(3-jumpcount)+'æ¬¡è·³éæ©Ÿæœƒ_',}));
   
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
		}else{
			if(wrong_count<=2){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>è«‹è©¦è‘—ç¹¼çºŒæ¥ä¸‹å»</s></p></speak>`);}
			else if(wrong_count<5){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>å¦‚æœä»æƒ³ä¸åˆ°å¯ä»¥æ¥ç”šéº¼è©å½™ï¼Œå¯ä»¥å°æˆ‘èªª<break time="0.2s"/>è·³éå®ƒ</s></p></speak>`);}
			else{conv.close(`<speak><p><s>ç”±æ–¼æˆ‘å€‘çš„å°è©±ç„¡æ³•ç¹¼çºŒï¼ŒéŠæˆ²å…ˆåˆ°é€™è£¡å…«<break time="0.2s"/>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
			}	
		 }
		else{			
		if(checker===1){

		wrong_array=[`<speak><p><s>éŒ¯èª¤!</s><s>ä¸èƒ½åªè¼¸å…¥ä¸€å€‹å­—!</s></p></speak>`,
			`<speak><p><s>${input}åªæœ‰ä¸€å€‹å­—ï¼Œæ¯æ¹¯å–”!</s></p></speak>`,
			`<speak><p><s>å®‰ã„‹ã„ŸË‰æ¯æ¹¯ï¼Œè«‹èªªè‡³å°‘æœ‰å…©çš„å­—çš„è©å½™</s></p></speak>`,
			`<speak><p><s>${input}åªæœ‰ä¸€å€‹å­—ï¼Œé€™æ¨£æ˜¯ä¸è¡Œçš„!</s></p></speak>`,						
			`<speak><p><s>é€™å€‹è©å½™åªæœ‰ä¸€å€‹å­—ï¼Œæˆ‘æ˜¯ä¸æœƒä¸Šç•¶çš„ã€‚</s></p></speak>`,];

		conv.ask(new SimpleResponse({
				speech:wrong_array[parseInt(Math.random()*4)],
				text: 'ã€Œ'+input+'ã€åªæœ‰ä¸€å€‹å­—æ˜¯ä¸è¡Œçš„',}));
		if(conv.screen){
		 conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ ç›®å‰å‰©ä¸‹'+(3-jumpcount)+'æ¬¡è·³éæ©Ÿæœƒ_',}));
 
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
		}else{
			if(wrong_count<=2){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>è«‹è©¦è‘—ç¹¼çºŒæ¥ä¸‹å»</s></p></speak>`);}
			else if(wrong_count<5){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>å¦‚æœä»æƒ³ä¸åˆ°å¯ä»¥æ¥ç”šéº¼è©å½™ï¼Œå¯ä»¥å°æˆ‘èªª<break time="0.2s"/>è·³éå®ƒ</s></p></speak>`);}
			else{conv.close(`<speak><p><s>ç”±æ–¼æˆ‘å€‘çš„å°è©±ç„¡æ³•ç¹¼çºŒï¼ŒéŠæˆ²å…ˆåˆ°é€™è£¡å…«<break time="0.2s"/>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
			}				
		}
		else{		
		if(last_word!==first_word){
		
		repeat=false;
		
		wrong_array=[`<speak><p><s>æƒ³çš„å¥½ï¼Œä½†æ˜¯${input}çš„è‡ªé¦–ä¸æ˜¯${last_word}å–”!å†æƒ³ä¸€å€‹å…«!</s></p></speak>`,
			`<speak><p><s>${input}çš„å­—é¦–å¥½åƒä¸å¤ªå°å–”ï¼Œè©¦è‘—æ›ä¸€å€‹å…«!</s></p></speak>`,
			`<speak><p><s>${input}çš„å­—é¦–å°ã„…ã„¨ËŠä¸Šå‘¢ï¼Œå†æƒ³ä¸€æƒ³å¾Œé ­å¯ä»¥æ¥ä»€éº¼è©å½™!</s></p></speak>`,
			`<speak><p><s>${input}çš„å­—é¦–ä¸å¤ªå°ï¼Œæ›ä¸€å€‹è©¦çœ‹çœ‹!</s></p></speak>`,						
			`<speak><p><s>é€™å€‹æˆèªçš„å­—é¦–ä¸æ˜¯æˆ‘è¦çš„ï¼Œè«‹æ›ä¸€å€‹ã€‚</s></p></speak>`,];

		conv.ask(new SimpleResponse({               
		speech:wrong_array[parseInt(Math.random()*4)],
		text: 'ä¸å¥½æ„æ€ï¼Œè«‹å†è¬›ä¸€æ¬¡å¥½å—ï¼Ÿ',}));

		if(conv.screen){
		 
		if(conv.input.type==="VOICE"){  //å¦‚æœè¼¸å…¥æ˜¯èªéŸ³ï¼Œå‰‡é¡¯ç¤ºéŒ¯èª¤è™•ç†æ–¹æ³•
		conv.ask(new BasicCard({
				title: 'ã€'+sys_word+'ã€',
				subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
				text:'*ã€ˆéŒ¯èª¤èªªæ˜ã€‰*  \n*GoogleèªéŸ³è¾¨è­˜å¯èƒ½ç™¼ç”ŸéŒ¯èª¤ï¼Œä½ å¯ä»¥å˜—è©¦ï¼š*  \nâ€¢ è©¦è‘—å†èªªä¸€æ¬¡  \nâ€¢ è‹¥éŒ¯èª¤æºè‡ªåŒéŸ³è©è¾¨è­˜ï¼Œè«‹è©¦è‘—åŠ é•·è©å½™é•·åº¦  \nâ€¢ é€ééµç›¤è¼¸å…¥æ¬²è¡¨é”çš„è©å½™  \nâ€¢ å‘Googleå›å ±è©²éŒ¯èª¤æ”¹å–„å…¶è¾¨è­˜èƒ½åŠ›'})); 
   	     conv.ask(new Suggestions('æˆ‘è¦é€²è¡Œå›å ±'));
		 }
		else{ //è¼¸å…¥æ–¹å¼ä¸æ˜¯èªéŸ³å‰‡é¡¯ç¤ºè¼¸å…¥éŒ¯èª¤

        conv.ask(new BasicCard({   
				title: 'ã€'+sys_word+'ã€',
				subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
				text:'_[!]ä½ ç›®å‰å‰©ä¸‹'+(3-jumpcount)+'æ¬¡è·³éæ©Ÿæœƒ_',}));
		  }

   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
		}else{
			if(wrong_count<=2){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>è«‹è©¦è‘—ç¹¼çºŒæ¥ä¸‹å»</s></p></speak>`);}
			else if(wrong_count<5){conv.ask(`<speak><p><s>ç¾åœ¨æ¥åˆ°<break time="0.2s"/>${sys_word}<break time="0.2s"/>å¦‚æœä»æƒ³ä¸åˆ°å¯ä»¥æ¥ç”šéº¼è©å½™ï¼Œå¯ä»¥å°æˆ‘èªª<break time="0.2s"/>è·³éå®ƒ</s></p></speak>`);}
			else{conv.close(`<speak><p><s>ç”±æ–¼æˆ‘å€‘çš„å°è©±ç„¡æ³•ç¹¼çºŒï¼ŒéŠæˆ²å…ˆåˆ°é€™è£¡å…«<break time="0.2s"/>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
		  }		
	  }
		else{
		Total_Count++;

	   if(input_list.indexOf(input)===-1){   //æª¢æŸ¥è¼¸å…¥çš„è©å½™æ˜¯å¦å·²é‡è¤‡
 
        input_list.push(input);//å°‡è©å½™å­˜å…¥ä½‡åˆ—
		input_word=input_init.pop();
		output_array=text_library[input_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
		
		if(typeof output_array==="undefined"){
	 	menu=false;question_output=false;end_game=true;reported=false; 
		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>å¯<break time="0.2s"/>å¯<break time="0.2s"/>å¯æƒ¡<break time="0.2s"/></s><s>æˆ‘ç«Ÿç„¶æ‰¾ä¸åˆ°å¯ä»¥æ¥ä¸‹å»çš„è©ï¼Œä½ è´æˆ‘äº†å‘¢!</s></p></speak>`,
			text: 'æˆ‘è¼¸äº† ğŸ˜±',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
			title: 'æˆ‘ä¸çŸ¥é“ã€'+input+'ã€å¾Œé¢è©²æ¥ä»€éº¼...',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
        Total_Count=0;input_list=[];start_game=false;		
		}else{
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™			
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
		}
		else{
		sys_word=output_array[parseInt(Math.random()*(output_array.length-1))];
        last_word=sys_word.split('');
		last_word=last_word.pop();
        
		if(input_list.indexOf(sys_word)!==-1){
	 	menu=false;question_output=false;end_game=true;reported=false; 
		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>å¯æƒ¡</s><s>æˆ‘ä¸å°å¿ƒèªªäº†æ›¾ç¶“èªªéçš„è©ï¼Œä½ è´æˆ‘äº†å‘¢!</s></p></speak>`,
			text: 'æˆ‘è¼¸äº† ğŸ˜±',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
			title: 'æ²’æƒ³åˆ°ã€'+sys_word+'ã€å·²ç¶“èªªéäº†',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
        Total_Count=0;input_list=[];start_game=false;		
		}else{
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™						
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
		}
		else{
		
		input_list.push(sys_word);//å°‡è©å½™å­˜å…¥ä½‡åˆ—
        output_array=text_library[last_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
		 
	 if(typeof output_array==="undefined"){
	 	menu=false;question_output=false;end_game=true;reported=false; 

		conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>ç³Ÿç³•<break time="0.2s"/>æˆ‘æ‰€æƒ³çš„${sys_word}æ˜¯æ²’è¾¦æ³•æ¥ä¸‹å»çš„!å›åˆçµæŸ!</s></p></speak>`,
			text: 'æˆ‘æ‰€æƒ³çš„è©æ˜¯æ¥ä¸ä¸‹å»çš„ï¼Œ\nå› æ­¤å›åˆçµæŸæ‹‰!',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
            title: 'æˆ‘æƒ³çš„ã€'+sys_word+'ã€æ¥ä¸ä¸‹å»æ‹‰!',
			subtitle:'æœ¬å›åˆå·²çµæŸ',
			text:'ä½ å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾(ä¸è¨ˆå…¥è·³éçš„è©å½™)',}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
        Total_Count=0;input_list=[];start_game=false;		
		}else{
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™						
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
		   }
		   else{
	     conv.ask(new SimpleResponse({               
						speech: `<speak><p><s>${sys_word}</s></p></speak>`,
						text: return_array[parseInt(Math.random()*4)],}));
		conv.noInputs = ["æˆ‘å‰›å‰›èªªçš„æ˜¯"+sys_word+"ï¼Œè«‹èªªä»¥"+last_word+"ç‚ºé–‹é ­çš„è©å½™","ç¾åœ¨çš„è©å½™æ˜¯"+sys_word+"ï¼Œè«‹ç¹¼çºŒæ¥ä¸‹å»","æŠ±æ­‰ï¼Œç”±æ–¼æ‚¨ä¸€ç›´æ²’æœ‰å›æ‡‰ã€‚å› æ­¤éŠæˆ²åˆ°æ­¤çµæŸã€‚ä½ åœ¨é€™å›åˆé€²è¡Œ"+Total_Count+"æ¬¡æ¥é¾ï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹ã€‚"];	   
		
		 conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ ç›®å‰å‰©ä¸‹'+(3-jumpcount)+'æ¬¡è·³éæ©Ÿæœƒ_',}));
	   
   	     if(jumpcount<=2){conv.ask(new Suggestions('è·³éé€™å€‹è©'));}
   	     conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));
       } 		
      }
	 }
	}else{
	 	menu=false;question_output=false;end_game=true;reported=false; 
        
		last_word=input.split('');
		last_word=last_word[0];
        output_array=text_library[last_word]; //é€²å…¥è©å½™åº«å–å¾—å°æ‡‰è©å½™
		sys_suggest=output_array[parseInt(Math.random()*(output_array.length-1))];

		   if(typeof output_array==="undefined"){subtitle_suggest='æˆ‘æ‰¾ä¸åˆ°...';}
										    else{subtitle_suggest='æœ‰ã€'+sys_suggest+'ã€ã€‚';}

        conv.ask(new SimpleResponse({               
					speech: `<speak><p><s>å±…å±…<break time="0.2s"/>ä½ è¼¸å…¥çš„${input}é‡è¤‡å›‰!</s><s>å›åˆçµæŸ!</s></p></speak>`,
					text: 'ä½ è¼¸å…¥é‡è¤‡çš„è©ï¼Œå› æ­¤å›åˆçµæŸæ‹‰!',}));
		if(conv.screen){	
		conv.ask(new BasicCard({   
			title: 'ã€'+input+'ã€å·²ç¶“è¼¸å…¥éå›‰!',
			subtitle:'æœ¬å›åˆå·²çµæŸ â€¢ å…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾\n\nâœ®å¢å¼·åŠŸåŠ›ï¼š\nä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™'+subtitle_suggest, 
			buttons: new Button({title:'åœ¨ã€ŠèŒå…¸ã€‹ä¸Šçœ‹ã€Œ'+last_word+'ã€çš„ç”¨æ³•',
								 url: 'https://www.moedict.tw/'+last_word,}), 		
			}));
		conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
        Total_Count=0;input_list=[];start_game=false;		
		}else{
		conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™
		conv.close(`<speak><p><s>åœ¨é€™å›åˆä¸­ä½ é€²è¡Œ${Total_Count}æ¬¡æ¥é¾ï¼Œä¸‹æ¬¡è¦‹!</s></p></speak>`);}
       }	
	  } 
	 }
	}
   }
  }
   else if(menu===false&&end_game===false&&question_output===true&&reported===true){
    reported=false;
        conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>å¥½çš„!æˆ‘å‰›å‰›èªªçš„æ˜¯<break time="0.2s"/>${sys_word}ï¼Œç¹¼çºŒæ¥ä¸‹å»å…«!</s></p></speak>`,
			text: 'OKï¼Œæˆ‘å€‘ç¹¼çºŒé€²è¡Œ!',}));
			
		 conv.ask(new BasicCard({   
			title: 'ã€'+sys_word+'ã€',
			subtitle:'è«‹è¼¸å…¥ä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™',
			text:'_[!]ä½ éš¨æ™‚éƒ½èƒ½é€€å‡ºéŠæˆ²_',}));
	   
	  conv.ask(new Suggestions('æ”¾æ£„æœ¬å›åˆ'));}
   else if(menu===false&&end_game===true&&question_output===true&&reported===true){
	 	menu=false;question_output=false;end_game=true;reported=false; 
     conv.ask(new SimpleResponse({               
			speech: `<speak><p><s>ä½ çš„å›åˆå·²ç¶“çµæŸäº†ï¼Œè«‹å•ä½ é‚„è¦å†ç©ä¸€æ¬¡å—?</s></p></speak>`,
			text: 'è«‹å•ä½ é‚„è¦å†ç©ä¸€æ¬¡å—?',}));
     conv.ask(new BasicCard({   
        image: new Image({url:'https://imgur.com/2oOhmvs.jpg',alt:'Pictures',}),
        title: 'æœ¬å›åˆå…±é€²è¡Œ'+Total_Count+'æ¬¡æ¥é¾',
        subtitle:'âœ®å¢å¼·åŠŸåŠ›ï¼š\nä»¥ã€Œ'+last_word+'ã€é–‹é ­çš„è©å½™'+subtitle_suggest, 
		buttons: new Button({title:'åœ¨ã€ŠèŒå…¸ã€‹ä¸Šçœ‹ã€Œ'+last_word+'ã€çš„ç”¨æ³•',
								 url: 'https://www.moedict.tw/'+last_word,}), 
        display: 'CROPPED',//æ›´æ”¹åœ–ç‰‡é¡¯ç¤ºæ¨¡å¼ç‚ºè‡ªå‹•æ“´å±•
       })); 

     conv.ask(new Suggestions('ğŸ”„ é‡æ–°é–‹å§‹','ğŸ‘‹ æ°æ°'));
  }

   else{
    conv.user.storage = {}; //é›¢é–‹åŒæ™‚æ¸…é™¤æš«å­˜è³‡æ–™
    conv.ask('å¸Œæœ›ä½ ç©å¾—æ„‰å¿«!');
    conv.ask(new SimpleResponse({speech: 'ä¸‹æ¬¡è¦‹',text: 'ä¸‹æ¬¡è¦‹ ğŸ‘‹',}));
    conv.close(new BasicCard({   
        title: 'æ„Ÿè¬æ‚¨çš„ä½¿ç”¨!', 
        text:'å¦‚æœæœ‰ä»»ä½•éœ€è¦æ”¹é€²çš„åœ°æ–¹ï¼Œ  \næ­¡è¿åˆ°ç°¡ä»‹é é¢è©•åˆ†æˆ–çµ¦äºˆåé¥‹ï¼Œè¬è¬!', 
        buttons: new Button({title: 'é–‹å•Ÿæœ¬ç¨‹å¼çš„å•†åº—é é¢',url: 'https://assistant.google.com/services/a/uid/000000ca4e8b5d65',}),
    })); 
  } 
  if(conv.user.storage !== undefined){
  	 conv.user.storage.menu=menu;
	 conv.user.storage.end_game=end_game;
	 conv.user.storage.question_output=question_output;
	 conv.user.storage.sys_word=sys_word;
	 conv.user.storage.last_word=last_word;
	 conv.user.storage.input_list=input_list;
	 conv.user.storage.Total_Count=Total_Count;
	 conv.user.storage.start_game=start_game;
     conv.user.storage.reported=reported;
	 conv.user.storage.jumpcount=jumpcount;
	}
});



exports.text_solitaire = functions.https.onRequest(app); 
